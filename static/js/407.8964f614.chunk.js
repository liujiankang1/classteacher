"use strict";(self.webpackChunkfrontend_react=self.webpackChunkfrontend_react||[]).push([[407],{3665:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(99992),s=a(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},5362:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(99992),s=a(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},21586:(e,t,a)=>{a.d(t,{A6:()=>r,LP:()=>u,Qu:()=>h,Rj:()=>l,Y:()=>s,dp:()=>d,ne:()=>c,s5:()=>i,w_:()=>o});const n=a(79722).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const s=async()=>await n.get("/api/students"),l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return console.log("\u5f00\u59cb\u83b7\u53d6\u5b66\u751f\u5206\u9875\u6570\u636e\uff0c\u76f4\u63a5\u8bf7\u6c42\u540e\u7aef"),await n.get("/api/students/paged?page=".concat(e,"&size=").concat(t))},r=async e=>await n.get("/api/students/class/".concat(e)),c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return await n.get("/api/students/class/".concat(e,"/paged?page=").concat(t,"&size=").concat(a))},o=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return await n.get("/api/students/search/paged?name=".concat(e,"&page=").concat(t,"&size=").concat(a))},i=async e=>await n.post("/api/students",e),d=async(e,t)=>await n.put("/api/students/".concat(e),t),u=async e=>await n.delete("/api/students/".concat(e)),h=async e=>await n.post("/api/students/batch",e,{headers:{"Content-Type":"multipart/form-data"}})},27421:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(99992),s=a(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},61713:(e,t,a)=>{a.d(t,{Yq:()=>s,dX:()=>c,r6:()=>n,vM:()=>r,xw:()=>l});const n=e=>{if(!e)return"";try{if(Array.isArray(e)){const[t,a,n,s=0,l=0]=e;return"".concat(t,"-").concat(String(a).padStart(2,"0"),"-").concat(String(n).padStart(2,"0")," ").concat(String(s).padStart(2,"0"),":").concat(String(l).padStart(2,"0"))}const t=new Date(e);if(isNaN(t.getTime()))return String(e);const a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(s," ").concat(l,":").concat(r)}catch(t){return console.error("\u65e5\u671f\u683c\u5f0f\u5316\u9519\u8bef:",t,e),String(e)}},s=e=>{if(!e)return"";const t=new Date(e),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(s)},l=()=>{const e=new Date,t=e.getDay()||7,a=new Date(e);a.setDate(e.getDate()-t+1),a.setHours(0,0,0,0);const n=new Date(e);return n.setDate(e.getDate()+(7-t)),n.setHours(23,59,59,999),[a,n]},r=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const a=new Date(e.getFullYear(),e.getMonth()+1,0);return a.setHours(23,59,59,999),[t,a]},c=()=>{const e=new Date;let t,a;return e.getMonth()<6?(t=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear(),5,30)):(t=new Date(e.getFullYear(),6,1),a=new Date(e.getFullYear(),11,31)),t.setHours(0,0,0,0),a.setHours(23,59,59,999),[t,a]}},63745:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(99992),s=a(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},69302:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(99992),s=a(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")},73407:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Q});var n=a(89379),s=a(65043),l=a(83759),r=a(53969),c=a(55895),o=a(12097),i=a(94799),d=a(24343),u=a(10256),h=a(3353),x=a(67203),p=a(47471),A=a(70298),g=a(28259),j=a(87443),v=a(10756),m=a(86172),y=a(81341),f=a(34375),S=a(80172),w=a(26529),C=a(42579),b=a(12272),R=a(38517),D=a(81911),I=a(78776),z=a(22947),T=a(85877),N=a(70916),P=a(91449),L=a(81133),k=a(72179),E=a(24793),M=a(22950),F=a(63745),O=a(69302),W=a(99992),H=a(70579);const Y=(0,W.A)((0,H.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");var V=a(27421),_=a(3665),q=a(5362),B=a(29066);const G=a(79722).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});G.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const K={getLeaves:async e=>(console.log("\u83b7\u53d6\u8bf7\u5047\u5217\u8868\uff0c\u76f4\u63a5\u8bf7\u6c42\u540e\u7aef"),await G.get("/api/leaves",{params:e})),getLeaveById:async e=>await G.get("/api/leaves/".concat(e)),createLeave:async e=>await G.post("/api/leaves",e),updateLeave:async(e,t)=>await G.put("/api/leaves/".concat(e),t),deleteLeave:async e=>await G.delete("/api/leaves/".concat(e)),approveLeave:async(e,t)=>await G.put("/api/leaves/".concat(e,"/approve"),null,{params:{approverId:t}}),rejectLeave:async(e,t)=>await G.put("/api/leaves/".concat(e,"/reject"),null,{params:{approverId:t}})};var J=a(61713),U=a(21586),$=a(75821);const Q=()=>{var e,t,a;const[W,G]=(0,s.useState)(!1),[Q,X]=(0,s.useState)([]),[Z,ee]=(0,s.useState)(0),[te,ae]=(0,s.useState)(0),[ne,se]=(0,s.useState)(10),[le,re]=(0,s.useState)(!1),[ce,oe]=(0,s.useState)("\u65b0\u589e\u8bf7\u5047"),[ie,de]=(0,s.useState)([]),[ue,he]=(0,s.useState)(!1),[xe,pe]=(0,s.useState)({}),[Ae,ge]=(0,s.useState)(!1),[je,ve]=(0,s.useState)(null),[me,ye]=(0,s.useState)(!1),[fe,Se]=(0,s.useState)(!1),[we,Ce]=(0,s.useState)(!1),[be,Re]=(0,s.useState)(!1),[De,Ie]=(0,s.useState)({open:!1,message:"",severity:"success"}),[ze,Te]=(0,s.useState)({open:!1,title:"",content:"",onConfirm:()=>{}}),Ne=(0,s.useRef)(null),{user:Pe}=(0,B.As)(),Le="ROLE_TEACHER"===(null===Pe||void 0===Pe?void 0:Pe.role),[ke,Ee]=(0,s.useState)({studentName:"",leaveType:"",status:"",dateRange:[null,null]}),[Me,Fe]=(0,s.useState)({id:null,studentId:"",leaveType:"",dateRange:[null,null],reason:""}),Oe=()=>{pe({})},We=async e=>{G(!0);try{const t=void 0!==e?e:te;console.log("\u5f53\u524d\u9875\u7801\u72b6\u6001:",te),console.log("\u5b9e\u9645\u4f7f\u7528\u7684\u9875\u7801:",t);const a={studentName:ke.studentName||null,leaveType:ke.leaveType||null,status:ke.status||null,startDate:ke.dateRange[0]?Ye(ke.dateRange[0]):null,endDate:ke.dateRange[1]?Ye(ke.dateRange[1]):null,page:t,size:ne};console.log("\u8bf7\u6c42\u53c2\u6570:",a);const s=await K.getLeaves(a);if(s&&s.data){console.log("\u8fd4\u56de\u6570\u636e:",s.data);const e=s.data.content||s.data,t=s.data.totalElements||e.length,a=e.map((e=>{var t,a,s,l;return(0,n.A)((0,n.A)({},e),{},{studentName:(null===(t=e.student)||void 0===t?void 0:t.name)||"\u672a\u77e5\u5b66\u751f",className:(null===(a=e.student)||void 0===a||null===(s=a.classInfo)||void 0===s?void 0:s.className)||"\u672a\u77e5\u73ed\u7ea7",approver:(null===(l=e.approver)||void 0===l?void 0:l.name)||""})}));X(a),ee(t)}else X([]),ee(0)}catch(t){console.error("\u83b7\u53d6\u8bf7\u5047\u5217\u8868\u5931\u8d25:",t),X([]),ee(0)}finally{G(!1)}},He=async()=>{try{const e=await(0,U.Y)();if(e&&e.data){const t=e.data.map((e=>({id:e.id,name:e.name,className:e.classInfo?e.classInfo.className:"\u672a\u5206\u914d\u73ed\u7ea7"})));de(t)}}catch(e){console.error("\u83b7\u53d6\u5b66\u751f\u5217\u8868\u5931\u8d25:",e)}},Ye=e=>{if(!e)return"";const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)},Ve=e=>{switch(e){case"SICK":return(0,H.jsx)(l.A,{label:"\u75c5\u5047",color:"error",size:"small"});case"PERSONAL":return(0,H.jsx)(l.A,{label:"\u4e8b\u5047",color:"warning",size:"small"});default:return(0,H.jsx)(l.A,{label:"\u5176\u4ed6",color:"default",size:"small"})}},_e=e=>{switch(e){case"PENDING":return(0,H.jsx)(l.A,{label:"\u5f85\u5ba1\u6279",color:"default",size:"small"});case"APPROVED":return(0,H.jsx)(l.A,{label:"\u5df2\u6279\u51c6",color:"success",size:"small"});case"REJECTED":return(0,H.jsx)(l.A,{label:"\u5df2\u62d2\u7edd",color:"error",size:"small"});default:return(0,H.jsx)(l.A,{label:"\u672a\u77e5",size:"small"})}},qe=e=>{const t=e.target.name,a=e.target.value;Fe((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a}))),xe[t]&&pe((e=>(0,n.A)((0,n.A)({},e),{},{[t]:""})))},Be=function(e){Ie({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},Ge=()=>{Ie((e=>(0,n.A)((0,n.A)({},e),{},{open:!1})))},Ke=(e,t,a)=>{Te({open:!0,title:e,content:t,onConfirm:a})},Je=()=>{Te((e=>(0,n.A)((0,n.A)({},e),{},{open:!1})))};return(0,s.useEffect)((()=>{We(),He()}),[]),(0,H.jsxs)(r.A,{children:[(0,H.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,H.jsx)(c.A,{variant:"h5",component:"h1",children:"\u5b66\u751f\u8bf7\u5047\u7ba1\u7406"}),!Le&&(0,H.jsx)(o.A,{variant:"contained",startIcon:(0,H.jsx)(M.A,{}),onClick:async()=>{Le?Be("\u6559\u5e08\u89d2\u8272\u65e0\u6743\u9650\u6dfb\u52a0\u8bf7\u5047\u8bb0\u5f55","warning"):(oe("\u65b0\u589e\u8bf7\u5047"),Fe({id:null,studentId:"",leaveType:"",dateRange:[null,null],reason:""}),Oe(),ge(!1),ve(null),Ce(!1),Re(!1),await He(),re(!0))},children:"\u65b0\u589e\u8bf7\u5047"})]}),(0,H.jsx)(i.A,{sx:{p:2,mb:3},children:(0,H.jsx)(E.$,{dateAdapter:k.h,adapterLocale:$.g,children:(0,H.jsxs)(r.A,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[(0,H.jsx)(r.A,{sx:{flex:"1 1 220px",maxWidth:{xs:"100%",sm:"220px"}},children:(0,H.jsx)(d.A,{name:"studentName",label:"\u5b66\u751f\u59d3\u540d",variant:"outlined",size:"small",fullWidth:!0,value:ke.studentName,onChange:e=>{const{name:t,value:a}=e.target;Ee((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a})))},InputProps:{endAdornment:(0,H.jsx)(F.A,{color:"action"})}})}),(0,H.jsx)(r.A,{sx:{flex:"1 1 220px",maxWidth:{xs:"100%",sm:"220px"}},children:(0,H.jsxs)(u.A,{fullWidth:!0,size:"small",children:[(0,H.jsx)(h.A,{children:"\u8bf7\u5047\u7c7b\u578b"}),(0,H.jsxs)(x.A,{name:"leaveType",label:"\u8bf7\u5047\u7c7b\u578b",value:ke.leaveType,onChange:e=>Ee((t=>(0,n.A)((0,n.A)({},t),{},{leaveType:e.target.value}))),children:[(0,H.jsx)(p.A,{value:"",children:"\u5168\u90e8"}),(0,H.jsx)(p.A,{value:"SICK",children:"\u75c5\u5047"}),(0,H.jsx)(p.A,{value:"PERSONAL",children:"\u4e8b\u5047"}),(0,H.jsx)(p.A,{value:"OTHER",children:"\u5176\u4ed6"})]})]})}),(0,H.jsx)(r.A,{sx:{flex:"1 1 220px",maxWidth:{xs:"100%",sm:"220px"}},children:(0,H.jsxs)(u.A,{fullWidth:!0,size:"small",children:[(0,H.jsx)(h.A,{children:"\u72b6\u6001"}),(0,H.jsxs)(x.A,{name:"status",label:"\u72b6\u6001",value:ke.status,onChange:e=>Ee((t=>(0,n.A)((0,n.A)({},t),{},{status:e.target.value}))),children:[(0,H.jsx)(p.A,{value:"",children:"\u5168\u90e8"}),(0,H.jsx)(p.A,{value:"PENDING",children:"\u5f85\u5ba1\u6279"}),(0,H.jsx)(p.A,{value:"APPROVED",children:"\u5df2\u6279\u51c6"}),(0,H.jsx)(p.A,{value:"REJECTED",children:"\u5df2\u62d2\u7edd"})]})]})}),(0,H.jsx)(r.A,{sx:{flex:"1 1 auto",maxWidth:{xs:"100%",sm:"280px"}},children:(0,H.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,H.jsx)("div",{style:{width:"126px"},children:(0,H.jsx)(L.l,{label:"\u5f00\u59cb\u65e5\u671f",value:ke.dateRange[0],onChange:e=>{Ee((t=>(0,n.A)((0,n.A)({},t),{},{dateRange:[e,t.dateRange[1]]})))},enableAccessibleFieldDOMStructure:!1,slotProps:{textField:{size:"small",fullWidth:!0,onClick:()=>ye(!0)}},open:me,onClose:()=>ye(!1)})}),(0,H.jsx)("div",{style:{width:"126px"},children:(0,H.jsx)(L.l,{label:"\u7ed3\u675f\u65e5\u671f",value:ke.dateRange[1],onChange:e=>{Ee((t=>(0,n.A)((0,n.A)({},t),{},{dateRange:[t.dateRange[0],e]})))},enableAccessibleFieldDOMStructure:!1,slotProps:{textField:{size:"small",fullWidth:!0,onClick:()=>Se(!0)}},open:fe,onClose:()=>Se(!1)})})]})}),(0,H.jsx)(r.A,{sx:{flex:"1 1 100%",display:"flex",justifyContent:"flex-end"},children:(0,H.jsxs)(A.A,{direction:"row",spacing:2,children:[(0,H.jsx)(o.A,{variant:"contained",onClick:e=>{e.preventDefault(),console.log("\u6267\u884c\u641c\u7d22"),ae(0),console.log("\u641c\u7d22\u540e\u7acb\u5373\u83b7\u53d6\u6570\u636e"),We(0)},startIcon:(0,H.jsx)(F.A,{}),type:"button",children:"\u67e5\u8be2"}),(0,H.jsx)(o.A,{variant:"outlined",onClick:e=>{e.preventDefault(),console.log("\u91cd\u7f6e\u7b5b\u9009\u6761\u4ef6"),Ee({studentName:"",leaveType:"",status:"",dateRange:[null,null]}),ae(0),console.log("\u91cd\u7f6e\u540e\u7acb\u5373\u83b7\u53d6\u6570\u636e"),We(0),Be("\u5df2\u91cd\u7f6e\u7b5b\u9009\u6761\u4ef6","info")},startIcon:(0,H.jsx)(O.A,{}),type:"button",children:"\u91cd\u7f6e"})]})})]})})}),(0,H.jsxs)(i.A,{sx:{width:"100%",overflow:"hidden"},children:[(0,H.jsx)(g.A,{sx:{maxHeight:440},children:(0,H.jsxs)(j.A,{stickyHeader:!0,"aria-label":"sticky table",children:[(0,H.jsx)(v.A,{children:(0,H.jsxs)(m.A,{children:[(0,H.jsx)(y.A,{children:"\u5b66\u751f\u59d3\u540d"}),(0,H.jsx)(y.A,{children:"\u73ed\u7ea7"}),(0,H.jsx)(y.A,{children:"\u8bf7\u5047\u7c7b\u578b"}),(0,H.jsx)(y.A,{children:"\u5f00\u59cb\u65e5\u671f"}),(0,H.jsx)(y.A,{children:"\u7ed3\u675f\u65e5\u671f"}),(0,H.jsx)(y.A,{children:"\u8bf7\u5047\u5929\u6570"}),(0,H.jsx)(y.A,{children:"\u8bf7\u5047\u539f\u56e0"}),(0,H.jsx)(y.A,{children:"\u72b6\u6001"}),(0,H.jsx)(y.A,{children:"\u5ba1\u6279\u4eba"}),(0,H.jsx)(y.A,{children:"\u7533\u8bf7\u65f6\u95f4"}),(0,H.jsx)(y.A,{children:"\u64cd\u4f5c"})]})}),(0,H.jsx)(f.A,{children:W?(0,H.jsx)(m.A,{children:(0,H.jsx)(y.A,{colSpan:11,align:"center",children:(0,H.jsx)(S.A,{size:24})})}):0===Q.length?(0,H.jsx)(m.A,{children:(0,H.jsx)(y.A,{colSpan:11,align:"center",children:"\u6ca1\u6709\u627e\u5230\u8bf7\u5047\u8bb0\u5f55"})}):Q.map((e=>(0,H.jsxs)(m.A,{hover:!0,children:[(0,H.jsx)(y.A,{children:e.studentName}),(0,H.jsx)(y.A,{children:e.className}),(0,H.jsx)(y.A,{children:Ve(e.leaveType)}),(0,H.jsx)(y.A,{children:e.startDate}),(0,H.jsx)(y.A,{children:e.endDate}),(0,H.jsx)(y.A,{children:e.duration}),(0,H.jsx)(y.A,{children:(0,H.jsx)(w.A,{title:e.reason,children:(0,H.jsx)("span",{children:e.reason.length>20?e.reason.substring(0,20)+"...":e.reason})})}),(0,H.jsx)(y.A,{children:_e(e.status)}),(0,H.jsx)(y.A,{children:e.approver||"-"}),(0,H.jsx)(y.A,{children:(0,J.r6)(e.createTime)}),(0,H.jsx)(y.A,{children:(0,H.jsxs)(A.A,{direction:"row",spacing:1,children:[!Le&&"PENDING"===e.status&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(C.A,{size:"small",color:"success",onClick:()=>(async e=>{Le?Be("\u6559\u5e08\u89d2\u8272\u65e0\u6743\u9650\u64cd\u4f5c","warning"):Pe&&Pe.id?Te({open:!0,title:"\u6279\u51c6\u8bf7\u5047",content:"\u786e\u5b9a\u6279\u51c6 ".concat(e.studentName," \u7684\u8bf7\u5047\u7533\u8bf7\u5417\uff1f"),onConfirm:async()=>{try{await K.approveLeave(e.id,Pe.id),Be("\u8bf7\u5047\u7533\u8bf7\u5df2\u6279\u51c6","success"),We()}catch(t){console.error("\u6279\u51c6\u8bf7\u5047\u5931\u8d25:",t),Be("\u6279\u51c6\u8bf7\u5047\u5931\u8d25","error")}}}):Be("\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55","error")})(e),title:"\u6279\u51c6",children:(0,H.jsx)(Y,{fontSize:"small"})}),(0,H.jsx)(C.A,{size:"small",color:"error",onClick:()=>(async e=>{Le?Be("\u6559\u5e08\u89d2\u8272\u65e0\u6743\u9650\u64cd\u4f5c","warning"):Pe&&Pe.id?Ke("\u62d2\u7edd\u8bf7\u5047","\u786e\u5b9a\u62d2\u7edd ".concat(e.studentName," \u7684\u8bf7\u5047\u7533\u8bf7\u5417\uff1f"),(async()=>{try{await K.rejectLeave(e.id,Pe.id),Be("\u8bf7\u5047\u7533\u8bf7\u5df2\u62d2\u7edd","success"),We()}catch(t){console.error("\u62d2\u7edd\u8bf7\u5047\u5931\u8d25:",t),Be("\u62d2\u7edd\u8bf7\u5047\u5931\u8d25","error")}})):Be("\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55","error")})(e),title:"\u62d2\u7edd",children:(0,H.jsx)(V.A,{fontSize:"small"})})]}),(0,H.jsx)(C.A,{size:"small",color:"primary",onClick:t=>{t.preventDefault(),t.stopPropagation(),(async e=>{try{var t;G(!0),ve(e),Fe({id:e.id,studentId:String(e.studentId||(null===(t=e.student)||void 0===t?void 0:t.id)||""),leaveType:e.leaveType,dateRange:[new Date(e.startDate),new Date(e.endDate)],reason:e.reason}),oe("\u67e5\u770b\u8bf7\u5047"),Oe(),ge(!0),Ce(!1),Re(!1),re(!0)}catch(a){console.error("\u83b7\u53d6\u8bf7\u5047\u8be6\u60c5\u5931\u8d25:",a)}finally{G(!1)}})(e)},title:"\u67e5\u770b",children:(0,H.jsx)(_.A,{fontSize:"small"})}),!Le&&(0,H.jsx)(C.A,{size:"small",color:"error",onClick:()=>(async e=>{Le?Be("\u6559\u5e08\u89d2\u8272\u65e0\u6743\u9650\u64cd\u4f5c","warning"):Te({open:!0,title:"\u5220\u9664\u8bf7\u5047",content:"\u786e\u5b9a\u5220\u9664 ".concat(e.studentName," \u7684\u8bf7\u5047\u8bb0\u5f55\u5417\uff1f"),onConfirm:async()=>{try{await K.deleteLeave(e.id),Be("\u8bf7\u5047\u8bb0\u5f55\u5df2\u5220\u9664","success"),We()}catch(t){console.error("\u5220\u9664\u8bf7\u5047\u5931\u8d25:",t),Be("\u5220\u9664\u8bf7\u5047\u5931\u8d25","error")}}})})(e),title:"\u5220\u9664",children:(0,H.jsx)(q.A,{fontSize:"small"})})]})})]},e.id)))})]})}),(0,H.jsx)(b.A,{rowsPerPageOptions:[5,10,25],component:"div",count:Z,rowsPerPage:ne,page:te,onPageChange:(e,t)=>{console.log("\u5207\u6362\u5230\u9875\u7801:",t),ae(t),console.log("\u9875\u7801\u5207\u6362\u540e\u7acb\u5373\u83b7\u53d6\u6570\u636e:",t),We(t)},onRowsPerPageChange:e=>{const t=parseInt(e.target.value,10);console.log("\u8bbe\u7f6e\u6bcf\u9875\u884c\u6570:",t),se(t),ae(0),console.log("\u66f4\u65b0\u6bcf\u9875\u884c\u6570\u540e\u7acb\u5373\u83b7\u53d6\u6570\u636e"),We(0)},labelRowsPerPage:"\u6bcf\u9875\u884c\u6570",labelDisplayedRows:e=>{let{from:t,to:a,count:n}=e;return"".concat(t,"-").concat(a," \u5171 ").concat(n)}})]}),(0,H.jsx)(E.$,{dateAdapter:k.h,adapterLocale:$.g,children:(0,H.jsxs)(R.A,{open:le,onClose:()=>re(!1),maxWidth:"md",fullWidth:!0,children:[(0,H.jsx)(D.A,{children:ce}),(0,H.jsx)(I.A,{children:(0,H.jsx)("form",{ref:Ne,onSubmit:e=>e.preventDefault(),children:(0,H.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,H.jsx)(r.A,{children:(0,H.jsxs)(u.A,{fullWidth:!0,error:!!xe.studentId,disabled:Ae,children:[(0,H.jsx)(h.A,{children:"\u5b66\u751f"}),(0,H.jsx)(x.A,{name:"studentId",label:"\u5b66\u751f",value:Me.studentId,onChange:e=>qe(e),disabled:Ae,children:Ae&&je?(0,H.jsxs)(p.A,{value:Me.studentId,children:[(null===(e=je.student)||void 0===e?void 0:e.name)||je.studentName||"\u672a\u77e5\u5b66\u751f","(",(null===(t=je.student)||void 0===t||null===(a=t.classInfo)||void 0===a?void 0:a.className)||je.className||"\u672a\u77e5\u73ed\u7ea7",")"]}):ie.map((e=>(0,H.jsxs)(p.A,{value:e.id,children:[e.name," (",e.className,")"]},e.id)))}),xe.studentId&&(0,H.jsx)(z.A,{children:xe.studentId})]})}),(0,H.jsx)(r.A,{children:(0,H.jsxs)(u.A,{fullWidth:!0,error:!!xe.leaveType,disabled:Ae,children:[(0,H.jsx)(h.A,{children:"\u8bf7\u5047\u7c7b\u578b"}),(0,H.jsxs)(x.A,{name:"leaveType",label:"\u8bf7\u5047\u7c7b\u578b",value:Me.leaveType,onChange:e=>qe(e),disabled:Ae,children:[(0,H.jsx)(p.A,{value:"SICK",children:"\u75c5\u5047"}),(0,H.jsx)(p.A,{value:"PERSONAL",children:"\u4e8b\u5047"}),(0,H.jsx)(p.A,{value:"OTHER",children:"\u5176\u4ed6"})]}),xe.leaveType&&(0,H.jsx)(z.A,{children:xe.leaveType})]})}),(0,H.jsxs)(r.A,{children:[(0,H.jsxs)(A.A,{direction:"row",spacing:2,children:[(0,H.jsx)(L.l,{label:"\u5f00\u59cb\u65e5\u671f",value:Me.dateRange[0],onChange:e=>{Fe((t=>(0,n.A)((0,n.A)({},t),{},{dateRange:[e,t.dateRange[1]]}))),xe.dateRange&&pe((e=>(0,n.A)((0,n.A)({},e),{},{dateRange:""})))},enableAccessibleFieldDOMStructure:!1,slotProps:{textField:{fullWidth:!0,error:!!xe.dateRange,onClick:()=>!Ae&&Ce(!0)}},disabled:Ae,readOnly:Ae,open:!Ae&&we,onClose:()=>Ce(!1)}),(0,H.jsx)(L.l,{label:"\u7ed3\u675f\u65e5\u671f",value:Me.dateRange[1],onChange:e=>{Fe((t=>(0,n.A)((0,n.A)({},t),{},{dateRange:[t.dateRange[0],e]}))),xe.dateRange&&pe((e=>(0,n.A)((0,n.A)({},e),{},{dateRange:""})))},enableAccessibleFieldDOMStructure:!1,slotProps:{textField:{fullWidth:!0,error:!!xe.dateRange,onClick:()=>!Ae&&Re(!0)}},disabled:Ae,readOnly:Ae,open:!Ae&&be,onClose:()=>Re(!1)})]}),xe.dateRange&&(0,H.jsx)(z.A,{error:!0,children:xe.dateRange})]}),(0,H.jsx)(r.A,{children:(0,H.jsx)(d.A,{name:"reason",label:"\u8bf7\u5047\u539f\u56e0",multiline:!0,rows:4,fullWidth:!0,value:Me.reason,onChange:e=>{const{name:t,value:a}=e.target;Fe((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a}))),xe[t]&&pe((e=>(0,n.A)((0,n.A)({},e),{},{[t]:""})))},error:!!xe.reason,helperText:xe.reason||"\u8bf7\u8f93\u5165\u8bf7\u5047\u539f\u56e0\uff085-500\u4e2a\u5b57\u7b26\uff09",inputProps:{maxLength:500},disabled:Ae,InputProps:{readOnly:Ae}})})]})})}),(0,H.jsxs)(T.A,{children:[(0,H.jsx)(o.A,{onClick:()=>re(!1),type:"button",children:Ae?"\u5173\u95ed":"\u53d6\u6d88"}),!Ae&&!Le&&(0,H.jsx)(o.A,{onClick:async()=>{if(Le)Be("\u6559\u5e08\u89d2\u8272\u65e0\u6743\u9650\u64cd\u4f5c","warning");else if((()=>{const e={};return Me.studentId||(e.studentId="\u8bf7\u9009\u62e9\u5b66\u751f"),Me.leaveType||(e.leaveType="\u8bf7\u9009\u62e9\u8bf7\u5047\u7c7b\u578b"),Me.dateRange[0]&&Me.dateRange[1]||(e.dateRange="\u8bf7\u9009\u62e9\u8bf7\u5047\u65f6\u95f4"),Me.reason?Me.reason.length<5?e.reason="\u8bf7\u5047\u539f\u56e0\u81f3\u5c115\u4e2a\u5b57\u7b26":Me.reason.length>500&&(e.reason="\u8bf7\u5047\u539f\u56e0\u6700\u591a500\u4e2a\u5b57\u7b26"):e.reason="\u8bf7\u8f93\u5165\u8bf7\u5047\u539f\u56e0",pe(e),0===Object.keys(e).length})()){he(!0);try{const e={studentId:parseInt(Me.studentId),leaveType:Me.leaveType,startDate:Ye(Me.dateRange[0]),endDate:Ye(Me.dateRange[1]),reason:Me.reason.trim()};Me.id?(await K.updateLeave(Me.id,e),Be("\u66f4\u65b0\u8bf7\u5047\u6210\u529f","success")):(await K.createLeave(e),Be("\u65b0\u589e\u8bf7\u5047\u6210\u529f","success")),re(!1),We()}catch(a){var e,t;console.error("\u63d0\u4ea4\u8bf7\u5047\u5931\u8d25:",a),Be("\u63d0\u4ea4\u8bf7\u5047\u5931\u8d25: "+((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"\u8bf7\u68c0\u67e5\u8f93\u5165"),"error")}finally{he(!1)}}},variant:"contained",disabled:ue,type:"button",children:ue?(0,H.jsx)(S.A,{size:24}):"\u786e\u5b9a"})]})]})}),(0,H.jsx)(N.A,{open:De.open,autoHideDuration:3e3,onClose:Ge,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,H.jsx)(P.A,{onClose:Ge,severity:De.severity,variant:"filled",sx:{width:"100%"},children:De.message})}),(0,H.jsxs)(R.A,{open:ze.open,onClose:Je,children:[(0,H.jsx)(D.A,{children:ze.title}),(0,H.jsx)(I.A,{children:(0,H.jsx)(c.A,{children:ze.content})}),(0,H.jsxs)(T.A,{children:[(0,H.jsx)(o.A,{onClick:Je,children:"\u53d6\u6d88"}),(0,H.jsx)(o.A,{onClick:()=>{ze.onConfirm(),Je()},color:"\u5220\u9664\u8bf7\u5047"===ze.title?"error":"primary",variant:"contained",autoFocus:!0,children:"\u5220\u9664\u8bf7\u5047"===ze.title?"\u786e\u5b9a\u5220\u9664":"\u786e\u5b9a"})]})]})]})}}}]);
//# sourceMappingURL=407.8964f614.chunk.js.map