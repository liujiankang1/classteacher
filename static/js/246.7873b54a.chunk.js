"use strict";(self.webpackChunkfrontend_react=self.webpackChunkfrontend_react||[]).push([[246],{21586:(e,t,s)=>{s.d(t,{A6:()=>r,LP:()=>u,Qu:()=>x,Rj:()=>o,Y:()=>n,dp:()=>d,ne:()=>c,s5:()=>i,w_:()=>l});const a=s(79722).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const n=async()=>await a.get("/api/students"),o=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return console.log("\u5f00\u59cb\u83b7\u53d6\u5b66\u751f\u5206\u9875\u6570\u636e\uff0c\u76f4\u63a5\u8bf7\u6c42\u540e\u7aef"),await a.get("/api/students/paged?page=".concat(e,"&size=").concat(t))},r=async e=>await a.get("/api/students/class/".concat(e)),c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return await a.get("/api/students/class/".concat(e,"/paged?page=").concat(t,"&size=").concat(s))},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return await a.get("/api/students/search/paged?name=".concat(e,"&page=").concat(t,"&size=").concat(s))},i=async e=>await a.post("/api/students",e),d=async(e,t)=>await a.put("/api/students/".concat(e),t),u=async e=>await a.delete("/api/students/".concat(e)),x=async e=>await a.post("/api/students/batch",e,{headers:{"Content-Type":"multipart/form-data"}})},45171:(e,t,s)=>{s.d(t,{A:()=>o});var a=s(89379);const n=s(79722).A.create({timeout:3e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use((e=>{var t;const s=localStorage.getItem("token");return e.url&&!e.url.startsWith("/")&&(e.url="/"+e.url),console.log("\u53d1\u9001\u8bf7\u6c42: ".concat(null===(t=e.method)||void 0===t?void 0:t.toUpperCase()," ").concat(e.url)),console.log("\u8bf7\u6c42\u5934:",e.headers),e.data&&console.log("\u8bf7\u6c42\u6570\u636e:","object"===typeof e.data?(0,a.A)((0,a.A)({},e.data),{},{password:e.data.password?"***":void 0,newPassword:e.data.newPassword?"***":void 0}):e.data),s&&(console.log("\u6dfb\u52a0\u8ba4\u8bc1\u5934: Bearer Token"),e.headers.Authorization="Bearer ".concat(s)),e}),(e=>(console.error("\u8bf7\u6c42\u9519\u8bef:",e),Promise.reject(e)))),n.interceptors.response.use((e=>(console.log("\u54cd\u5e94: ".concat(e.status," ").concat(e.config.url)),console.log("\u54cd\u5e94\u6570\u636e:",e.data),e)),(e=>{if("ECONNABORTED"===e.code&&e.message&&e.message.includes("timeout"))console.error("\u8bf7\u6c42\u8d85\u65f6:",e.config.url);else if(e.response){if(console.error("\u54cd\u5e94\u9519\u8bef:",e.response.status,e.response.data),401===e.response.status||403===e.response.status){if(e.config.url&&(e.config.url.includes("/auth/change-password")||e.config.url.includes("/api/auth/change-password")||e.config.url.includes("/auth/reset-password-with-code")||e.config.url.includes("/api/auth/reset-password-with-code")))return console.log("\u5bc6\u7801\u76f8\u5173\u8bf7\u6c42\u5931\u8d25\uff0c\u4f46\u4e0d\u91cd\u5b9a\u5411"),Promise.reject(e);console.error("\u8ba4\u8bc1\u9519\u8bef:",e.response.data),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.pathname.includes("/login")||(window.location.href="/login?redirect="+encodeURIComponent(window.location.pathname))}}else console.error("\u7f51\u7edc\u9519\u8bef:",e.message);return Promise.reject(e)}));const o=n},96663:(e,t,s)=>{s.d(t,{B3:()=>o,Ds:()=>r,pz:()=>c,tV:()=>n,wk:()=>l});const a=s(45171).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=arguments.length>3?arguments[3]:void 0;const o={page:t,size:s};return n&&(o.subjectId=n),console.log("\u6b63\u5728\u8bf7\u6c42\u6210\u7ee9\u6570\u636e: /api/scores/student-scores/exam/".concat(e,"?page=").concat(t,"&size=").concat(s).concat(n?"&subjectId="+n:"")),a.get("/api/scores/student-scores/exam/".concat(e),{params:o})},o=async e=>(console.log("\u4fdd\u5b58\u5b66\u751f\u6210\u7ee9:",e),a.post("/api/scores/manual",e)),r=async e=>{const t=await a.get("/api/scores/export",{params:{examId:e},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=s;const o=t.headers["content-disposition"];let r="\u6210\u7ee9\u8868_".concat(e,".xlsx");if(o){const e=o.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(r=e[1].replace(/['"]/g,""))}n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)},c=async e=>{const t=await a.get("/api/scores/template/download",{params:{examId:e},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=s,n.setAttribute("download","\u6210\u7ee9\u5bfc\u5165\u6a21\u677f_".concat(e,".xlsx")),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)},l=async(e,t)=>{const s=new FormData;return s.append("file",t),s.append("examId",e.toString()),console.log("\u6b63\u5728\u5bfc\u5165\u6210\u7ee9\u6570\u636e: examId=".concat(e,", fileName=").concat(t.name)),a.post("/api/scores/import",s,{headers:{"Content-Type":"multipart/form-data"}})}},98512:(e,t,s)=>{s.d(t,{CB:()=>l,Dt:()=>d,FP:()=>i,I$:()=>o,Qg:()=>n,YB:()=>r,gg:()=>c,lu:()=>u});const a=s(79722).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const n=async()=>(console.log("\u83b7\u53d6\u6240\u6709\u8003\u8bd5\uff0c\u76f4\u63a5\u8bf7\u6c42\u540e\u7aef"),a.get("/api/exams")),o=async e=>a.get("/api/exams/".concat(e)),r=e=>a.get("/api/exams/class/".concat(e)),c=e=>a.get("/api/exams/status/".concat(e)),l=async e=>a.post("/api/exams",e),i=async(e,t)=>a.put("/api/exams/".concat(e),t),d=async e=>a.delete("/api/exams/".concat(e)),u=async(e,t)=>a.patch("/api/exams/".concat(e,"/status"),{status:t})},99246:(e,t,s)=>{s.r(t),s.d(t,{default:()=>J});var a=s(89379),n=s(65043),o=s(94799),r=s(53969),c=s(91244),l=s(7240),i=s(70298),d=s(10256),u=s(3353),x=s(67203),h=s(47471),p=s(12097),m=s(16128),g=s(80172),A=s(55895),j=s(83759),v=s(94527),b=s(28259),f=s(87443),y=s(10756),w=s(86172),S=s(81341),C=s(34375),N=s(12272),I=s(38517),k=s(81911),P=s(42579),R=s(78776),D=s(24343),E=s(85877),z=s(57994),T=s(33699),O=s(70916),B=s(91449),W=s(58128),L=s(22950),U=s(37305),F=s(27421),G=s(22672),_=s(80664),M=s(3260),q=s(24793),H=s(72179),Y=s(75821),Q=(s(79722),s(98512)),V=s(96663),$=s(21586),Z=s(70579);(0,W.Ay)(o.A)((e=>{let{theme:t}=e;return(0,a.A)((0,a.A)({backgroundColor:"dark"===t.palette.mode?"#1A2027":"#fff"},t.typography.body2),{},{padding:t.spacing(1),color:t.palette.text.secondary})}));const J=()=>{var e,t,s;const[W,J]=(0,n.useState)([]),[K,X]=(0,n.useState)([]),[ee,te]=(0,n.useState)(!1),[se,ae]=(0,n.useState)(null),[ne,oe]=(0,n.useState)(null),[re,ce]=(0,n.useState)(null),[le,ie]=(0,n.useState)(0),[de,ue]=(0,n.useState)(10),[xe,he]=(0,n.useState)(1),[pe,me]=(0,n.useState)({highest:0,lowest:0,average:0}),[ge,Ae]=(0,n.useState)(!1),[je,ve]=(0,n.useState)(null),[be,fe]=(0,n.useState)(!1),[ye,we]=(0,n.useState)(!1),[Se,Ce]=(0,n.useState)(1),[Ne,Ie]=(0,n.useState)(!1),[ke,Pe]=(0,n.useState)(null),[Re,De]=(0,n.useState)(null),[Ee,ze]=(0,n.useState)({studentNumber:"",studentName:"",scores:{}}),[Te,Oe]=(0,n.useState)({open:!1,message:"",severity:"success"}),[Be,We]=(0,n.useState)([]),[Le,Ue]=(0,n.useState)(""),[Fe,Ge]=(0,n.useState)(null),_e=(0,M.zy)(),Me=((0,M.Zp)(),(0,n.useCallback)((async()=>{te(!0);try{const e=await Q.Qg();if(e.data&&Array.isArray(e.data)){J(e.data.map((e=>{var t;return(0,a.A)((0,a.A)({},e),{},{name:e.examName||e.name,className:(null===(t=e.classInfo)||void 0===t?void 0:t.className)||"\u672a\u77e5\u73ed\u7ea7"})})));const t=new URLSearchParams(_e.search).get("examId");if(t){const s=e.data.find((e=>String(e.id)===String(t)));s&&ae(s.id)}}}catch(e){console.error("\u83b7\u53d6\u8003\u8bd5\u5217\u8868\u5931\u8d25:",e)}finally{te(!1)}}),[_e.search])),qe=(0,n.useCallback)((async()=>{if(se){te(!0),ce(null),X([]);try{const s=(await Q.I$(se)).data;if(s){var e,t;const a=(null===(e=s.examSubjects)||void 0===e?void 0:e.map((e=>{var t;return{id:e.id||0,name:e.subjectName||(null===(t=e.subject)||void 0===t?void 0:t.name)||"\u672a\u547d\u540d\u79d1\u76ee",score:e.fullScore||100}})))||[];console.log("\u8003\u8bd5\u79d1\u76ee\u6570\u636e:",a),ce({id:s.id,name:s.examName||s.name,examDate:s.examDate,className:(null===(t=s.classInfo)||void 0===t?void 0:t.className)||"N/A",status:s.status,subjects:a,classInfo:s.classInfo}),He()}}catch(s){console.error("\u83b7\u53d6\u8003\u8bd5\u4fe1\u606f\u5931\u8d25:",s)}finally{te(!1)}}}),[se]),He=(0,n.useCallback)((async()=>{if(re&&re.id){te(!0);try{const e=await V.tV(re.id,xe-1,de,ne||void 0);if(e.data&&e.data.content){const t=e.data.content;console.log("\u540e\u7aef\u8fd4\u56de\u7684\u5b66\u751f\u6210\u7ee9\u6570\u636e:",t),console.log("\u5f53\u524d\u8003\u8bd5\u79d1\u76ee:",re.subjects),console.log("\u5f53\u524d\u9009\u4e2d\u7684\u79d1\u76eeID:",ne),t.length>0&&(console.log("\u7b2c\u4e00\u4e2a\u5b66\u751f\u7684\u6210\u7ee9:",t[0].scores),console.log("\u53ef\u7528\u7684\u79d1\u76eeID:",Object.keys(t[0].scores)));const s=t.map((e=>(0,a.A)((0,a.A)({},e),{},{scores:Object.entries(e.scores||{}).reduce(((e,t)=>{let[s,a]=t;return e[Number(s)]=a,e}),{})})));X(s),ie(e.data.totalElements||s.length),Ye(s)}}catch(e){console.error("\u83b7\u53d6\u6210\u7ee9\u6570\u636e\u5931\u8d25:",e)}finally{te(!1)}}else te(!1)}),[re,xe,de,ne]),Ye=e=>{if(0===e.length)return void me({highest:0,lowest:0,average:0});const t=Math.max(...e.map((e=>e.totalScore))),s=Math.min(...e.map((e=>e.totalScore))),a=e.reduce(((e,t)=>e+t.totalScore),0)/e.length;me({highest:t,lowest:s,average:a})},Qe=e=>{const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)},Ve=e=>e.rank<=3,$e=async(e,t,s)=>{if(null===re||void 0===re||!re.id)return;const a={examId:re.id,studentNumber:e.studentNumber,studentName:e.studentName,scores:{[t]:s}};try{const e=await V.B3(a);!e.data||200!==e.data.code&&200!==e.status||console.log("\u6210\u7ee9\u4fdd\u5b58\u6210\u529f")}catch(r){var n,o;console.error("\u6210\u7ee9\u4fdd\u5b58\u5931\u8d25:",r),Ze((null===(n=r.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"\u6210\u7ee9\u4fdd\u5b58\u5931\u8d25","error")}},Ze=function(e){Oe({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},Je=()=>{Oe((e=>(0,a.A)((0,a.A)({},e),{},{open:!1})))},Ke=()=>{ze({studentNumber:"",studentName:"",scores:{}})},Xe=(0,n.useCallback)((async()=>{try{const e=await $.Y();e.data&&We(e.data)}catch(e){console.error("\u83b7\u53d6\u5b66\u751f\u5217\u8868\u5931\u8d25:",e)}}),[]);(0,n.useEffect)((()=>{Me(),Xe()}),[Me,Xe]),(0,n.useEffect)((()=>{se&&qe()}),[se,qe]),(0,n.useEffect)((()=>{se&&He()}),[xe,de,He]);return(0,Z.jsx)(q.$,{dateAdapter:H.h,adapterLocale:Y.g,children:(0,Z.jsxs)(r.A,{sx:{p:3},className:"score-container page-container",children:[(0,Z.jsxs)(c.A,{className:"score-card apple-card",elevation:3,children:[(0,Z.jsx)(l.A,{title:"\u6210\u7ee9\u7ba1\u7406",action:(0,Z.jsxs)(i.A,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[(0,Z.jsxs)(d.A,{size:"small",sx:{minWidth:200},children:[(0,Z.jsx)(u.A,{children:"\u9009\u62e9\u8003\u8bd5"}),(0,Z.jsxs)(x.A,{value:se||"",label:"\u9009\u62e9\u8003\u8bd5",onChange:e=>(e=>{const t=e.target.value;ae(t),he(1),oe(null)})(e),children:[(0,Z.jsx)(h.A,{value:"",children:(0,Z.jsx)("em",{children:"\u8bf7\u9009\u62e9\u8003\u8bd5"})}),W.map((e=>(0,Z.jsxs)(h.A,{value:e.id,children:[e.name," - ",e.className]},e.id)))]})]}),re&&(0,Z.jsxs)(d.A,{size:"small",sx:{minWidth:150},children:[(0,Z.jsx)(u.A,{children:"\u9009\u62e9\u79d1\u76ee"}),(0,Z.jsxs)(x.A,{value:ne||"",label:"\u9009\u62e9\u79d1\u76ee",onChange:e=>(e=>{const t=e.target.value;oe(0===t?null:t),he(1)})(e),children:[(0,Z.jsx)(h.A,{value:"",children:(0,Z.jsx)("em",{children:"\u5168\u90e8\u79d1\u76ee"})}),null===(e=re.subjects)||void 0===e?void 0:e.map((e=>(0,Z.jsx)(h.A,{value:e.id,children:e.name},e.id)))]})]}),re&&(0,Z.jsx)(p.A,{variant:"contained",startIcon:(0,Z.jsx)(L.A,{}),onClick:()=>{we(!0),Ce(1),Pe(se),Ke()},children:"\u5f55\u5165\u6210\u7ee9"}),re&&K.length>0&&(0,Z.jsx)(p.A,{variant:"outlined",startIcon:(0,Z.jsx)(U.A,{}),onClick:()=>{if(se)try{V.Ds(se)}catch(e){console.error("\u6210\u7ee9\u5bfc\u51fa\u5931\u8d25:",e)}},children:"\u5bfc\u51faExcel"})]}),sx:{"& .MuiCardHeader-action":{mt:{xs:2,sm:0},ml:{sm:"auto"}}}}),(0,Z.jsxs)(m.A,{children:[ee&&(0,Z.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,Z.jsx)(g.A,{})}),!ee&&!re&&(0,Z.jsx)(A.A,{sx:{textAlign:"center",my:3},children:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u8003\u8bd5"}),!ee&&re&&0===K.length&&(0,Z.jsx)(A.A,{sx:{textAlign:"center",my:3},children:"\u6682\u65e0\u6210\u7ee9\u6570\u636e"}),!ee&&re&&K.length>0&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(r.A,{sx:{mb:3,p:2,bgcolor:"background.paper",borderRadius:1,boxShadow:1},children:[(0,Z.jsx)(A.A,{variant:"h6",gutterBottom:!0,children:"\u8003\u8bd5\u4fe1\u606f"}),(0,Z.jsx)(r.A,{sx:{flexGrow:1},children:(0,Z.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"1fr 1fr 1fr 1fr"},gap:2},children:[(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u8003\u8bd5\u540d\u79f0"}),(0,Z.jsx)(A.A,{variant:"body1",children:re.name})]}),(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u8003\u8bd5\u65e5\u671f"}),(0,Z.jsx)(A.A,{variant:"body1",children:(e=>{if(!e)return"";try{if("string"===typeof e&&e.includes("-")){const t=new Date(e);return isNaN(t.getTime())?e:Qe(t)}const t=new Date(e);return Qe(t)}catch(t){return"\u65e5\u671f\u65e0\u6548"}})(re.examDate)})]}),(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u73ed\u7ea7"}),(0,Z.jsx)(A.A,{variant:"body1",children:re.className})]}),(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u72b6\u6001"}),(0,Z.jsx)(j.A,{label:(e=>{switch(e){case"PENDING":return"\u672a\u5f00\u59cb";case"IN_PROGRESS":return"\u8fdb\u884c\u4e2d";case"FINISHED":return"\u5df2\u7ed3\u675f";case"GRADED":return"\u5df2\u8bc4\u5206";default:return"\u672a\u77e5"}})(re.status),color:(e=>{switch(e){case"PENDING":return"info";case"IN_PROGRESS":return"warning";case"FINISHED":return"success";case"GRADED":return"primary";default:return"default"}})(re.status),size:"small"})]})]})}),(0,Z.jsx)(v.A,{sx:{my:2}}),(0,Z.jsx)(A.A,{variant:"h6",gutterBottom:!0,children:"\u6210\u7ee9\u7edf\u8ba1"}),(0,Z.jsx)(r.A,{sx:{flexGrow:1},children:(0,Z.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr 1fr"},gap:2},children:[(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u6700\u9ad8\u5206"}),(0,Z.jsx)(A.A,{variant:"body1",children:pe.highest})]}),(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u6700\u4f4e\u5206"}),(0,Z.jsx)(A.A,{variant:"body1",children:pe.lowest})]}),(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(A.A,{variant:"body2",color:"text.secondary",children:"\u5e73\u5747\u5206"}),(0,Z.jsx)(A.A,{variant:"body1",children:pe.average.toFixed(2)})]})]})})]}),(0,Z.jsx)(b.A,{component:o.A,elevation:0,sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:(0,Z.jsxs)(f.A,{className:"score-table apple-table",children:[(0,Z.jsx)(y.A,{children:(0,Z.jsxs)(w.A,{children:[(0,Z.jsx)(S.A,{children:"\u5b66\u53f7"}),(0,Z.jsx)(S.A,{children:"\u59d3\u540d"}),(0,Z.jsx)(S.A,{children:"\u73ed\u7ea7"}),null===(t=re.subjects)||void 0===t?void 0:t.map((e=>(0,Z.jsxs)(S.A,{children:[e.name,"\u6210\u7ee9"]},e.id))),(0,Z.jsx)(S.A,{children:"\u603b\u5206"}),(0,Z.jsx)(S.A,{children:"\u6392\u540d"}),(0,Z.jsx)(S.A,{children:"\u8bc4\u8bed"}),(0,Z.jsx)(S.A,{children:"\u4e0a\u4f20\u65f6\u95f4"}),(0,Z.jsx)(S.A,{children:"\u64cd\u4f5c"})]})}),(0,Z.jsx)(C.A,{children:K.map((e=>{var t;return(0,Z.jsxs)(w.A,{sx:Ve(e)?{backgroundColor:"rgba(76, 175, 80, 0.1)"}:{},children:[(0,Z.jsx)(S.A,{children:e.studentNumber}),(0,Z.jsx)(S.A,{children:e.studentName}),(0,Z.jsx)(S.A,{children:e.className||"-"}),null===(t=re.subjects)||void 0===t?void 0:t.map((t=>(0,Z.jsx)(S.A,{children:void 0!==e.scores[t.id]?e.scores[t.id]:"-"},t.id))),(0,Z.jsx)(S.A,{children:e.totalScore}),(0,Z.jsx)(S.A,{children:(0,Z.jsx)(j.A,{label:e.rank,color:e.rank<=3?"primary":"default",size:"small"})}),(0,Z.jsx)(S.A,{children:e.comment||"-"}),(0,Z.jsx)(S.A,{children:e.createdAt||"-"}),(0,Z.jsx)(S.A,{children:(0,Z.jsx)(p.A,{size:"small",variant:"contained",onClick:()=>(e=>{ve((0,a.A)({},e)),Ae(!0)})(e),children:"\u7f16\u8f91"})})]},e.studentId)}))})]})}),(0,Z.jsx)(N.A,{component:"div",count:le,page:xe-1,onPageChange:(e,t)=>{he(t+1)},rowsPerPage:de,onRowsPerPageChange:e=>{ue(parseInt(e.target.value,10)),he(1)},rowsPerPageOptions:[5,10,25,50],labelRowsPerPage:"\u6bcf\u9875\u884c\u6570",labelDisplayedRows:e=>{let{from:t,to:s,count:a}=e;return"".concat(t,"-").concat(s," \u5171 ").concat(a)}})]})]})]}),(0,Z.jsxs)(I.A,{open:ge,onClose:()=>Ae(!1),maxWidth:"md",fullWidth:!0,children:[(0,Z.jsxs)(k.A,{sx:{pb:1},children:["\u7f16\u8f91\u5b66\u751f\u6210\u7ee9",(0,Z.jsx)(P.A,{"aria-label":"close",onClick:()=>Ae(!1),sx:{position:"absolute",right:8,top:8},children:(0,Z.jsx)(F.A,{})})]}),(0,Z.jsx)(R.A,{sx:{pt:2},children:je&&(0,Z.jsxs)(r.A,{children:[(0,Z.jsx)(o.A,{elevation:0,sx:{p:2,mb:3,bgcolor:"background.default",borderRadius:2,border:"1px solid",borderColor:"divider"},children:(0,Z.jsxs)(r.A,{sx:{display:"flex",flexWrap:"wrap"},children:[(0,Z.jsxs)(r.A,{sx:{width:{xs:"100%",sm:"33.33%"},p:1},children:[(0,Z.jsx)(A.A,{variant:"caption",color:"textSecondary",children:"\u5b66\u751f\u59d3\u540d"}),(0,Z.jsx)(A.A,{variant:"body1",fontWeight:"medium",children:je.studentName})]}),(0,Z.jsxs)(r.A,{sx:{width:{xs:"100%",sm:"33.33%"},p:1},children:[(0,Z.jsx)(A.A,{variant:"caption",color:"textSecondary",children:"\u5b66\u53f7"}),(0,Z.jsx)(A.A,{variant:"body1",fontWeight:"medium",children:je.studentNumber})]}),(0,Z.jsxs)(r.A,{sx:{width:{xs:"100%",sm:"33.33%"},p:1},children:[(0,Z.jsx)(A.A,{variant:"caption",color:"textSecondary",children:"\u73ed\u7ea7"}),(0,Z.jsx)(A.A,{variant:"body1",fontWeight:"medium",children:je.className||"\u672a\u5206\u914d\u73ed\u7ea7"})]})]})}),(0,Z.jsx)(A.A,{variant:"h6",sx:{mb:2,fontSize:"1rem"},children:"\u79d1\u76ee\u6210\u7ee9"}),(0,Z.jsx)(r.A,{sx:{display:"flex",flexWrap:"wrap",mx:-1},children:null===re||void 0===re||null===(s=re.subjects)||void 0===s?void 0:s.map((e=>(0,Z.jsx)(r.A,{sx:{width:{xs:"100%",sm:"50%",md:"33.33%"},p:1},children:(0,Z.jsxs)(o.A,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s","&:hover":{boxShadow:2}},children:[(0,Z.jsx)(A.A,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:e.name}),(0,Z.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,Z.jsx)(D.A,{type:"number",fullWidth:!0,variant:"outlined",size:"small",value:je.scores[e.id]||"",onChange:t=>((e,t,s)=>{const a=[...K],n=a.findIndex((t=>t.id===e.id));if(-1!==n){a[n].scores[t]=s;let o=0;Object.keys(a[n].scores).forEach((e=>{o+=a[n].scores[e]||0})),a[n].totalScore=o,X(a);const r=[...a].sort(((e,t)=>t.totalScore-e.totalScore));r.forEach(((e,t)=>{e.rank=t+1})),Ye(r),$e(e,t,s)}})(je,e.id,Number(t.target.value)),inputProps:{min:0,max:e.score,step:.5,style:{textAlign:"center",fontSize:"1.2rem"}}}),(0,Z.jsxs)(A.A,{variant:"caption",color:"textSecondary",sx:{ml:1,whiteSpace:"nowrap"},children:["/ ",e.score,"\u5206"]})]})]})},e.id)))}),(0,Z.jsxs)(o.A,{sx:{mt:3,p:2,bgcolor:"primary.50",borderRadius:2,display:"flex",justifyContent:"space-around"},children:[(0,Z.jsxs)(r.A,{sx:{textAlign:"center"},children:[(0,Z.jsx)(A.A,{variant:"caption",color:"textSecondary",children:"\u603b\u5206"}),(0,Z.jsx)(A.A,{variant:"h5",color:"primary.main",fontWeight:"bold",children:je.totalScore||0})]}),(0,Z.jsx)(v.A,{orientation:"vertical",flexItem:!0,sx:{mx:2}}),(0,Z.jsxs)(r.A,{sx:{textAlign:"center"},children:[(0,Z.jsx)(A.A,{variant:"caption",color:"textSecondary",children:"\u6392\u540d"}),(0,Z.jsx)(A.A,{variant:"h5",color:"primary.main",fontWeight:"bold",children:je.rank||"-"})]})]})]})}),(0,Z.jsxs)(E.A,{sx:{px:3,py:2},children:[(0,Z.jsx)(p.A,{onClick:()=>Ae(!1),variant:"outlined",children:"\u53d6\u6d88"}),(0,Z.jsx)(p.A,{variant:"contained",color:"primary",onClick:async()=>{if(je&&re){fe(!0);try{const e={};Object.keys(je.scores).forEach((t=>{const s=je.scores[Number(t)];null!==s&&void 0!==s&&(e[t]=s)}));const t={examId:re.id,studentNumber:je.studentNumber,studentName:je.studentName,scores:e},s=await V.B3(t);!s.data||200!==s.data.code&&200!==s.status||(Ze("\u4fdd\u5b58\u6210\u7ee9\u6210\u529f","success"),Ae(!1),He())}catch(s){var e,t;Ze((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"\u4fdd\u5b58\u6210\u7ee9\u5931\u8d25","error")}finally{fe(!1)}}},disabled:be,startIcon:be?(0,Z.jsx)(g.A,{size:20}):(0,Z.jsx)(G.A,{}),sx:{ml:2},children:"\u4fdd\u5b58"})]})]}),(0,Z.jsxs)(I.A,{open:ye,onClose:()=>we(!1),maxWidth:"md",fullWidth:!0,children:[(0,Z.jsxs)(k.A,{children:["\u6279\u91cf\u5f55\u5165\u6210\u7ee9",(0,Z.jsx)(P.A,{"aria-label":"close",onClick:()=>we(!1),sx:{position:"absolute",right:8,top:8},children:(0,Z.jsx)(F.A,{})})]}),(0,Z.jsx)(R.A,{sx:{pt:3},children:(0,Z.jsxs)(i.A,{spacing:3,children:[(0,Z.jsx)(r.A,{sx:{transform:"translateY(6px)"},children:(0,Z.jsxs)(d.A,{fullWidth:!0,sx:{minHeight:"56px",marginTop:"12px","& .MuiInputLabel-root":{backgroundColor:"background.paper",padding:"0 4px",zIndex:1},"& .MuiOutlinedInput-root":{backgroundColor:"background.paper"}},children:[(0,Z.jsx)(u.A,{id:"batch-exam-select-label",children:"\u9009\u62e9\u8003\u8bd5"}),(0,Z.jsx)(x.A,{labelId:"batch-exam-select-label",value:ke||"",onChange:e=>Pe(e.target.value),label:"\u9009\u62e9\u8003\u8bd5",children:W.map((e=>(0,Z.jsxs)(h.A,{value:e.id,children:[e.name," - ",e.className]},e.id)))})]})}),(0,Z.jsx)(r.A,{children:(0,Z.jsxs)(d.A,{component:"fieldset",children:[(0,Z.jsx)(A.A,{variant:"subtitle1",gutterBottom:!0,children:"\u5f55\u5165\u65b9\u5f0f"}),(0,Z.jsxs)(i.A,{direction:"row",spacing:2,children:[(0,Z.jsx)(p.A,{variant:1===Se?"contained":"outlined",onClick:()=>Ce(1),startIcon:(0,Z.jsx)(_.A,{}),children:"Excel\u6587\u4ef6\u5bfc\u5165"}),(0,Z.jsx)(p.A,{variant:2===Se?"contained":"outlined",onClick:()=>Ce(2),startIcon:(0,Z.jsx)(L.A,{}),children:"\u624b\u52a8\u5f55\u5165"})]})]})}),1===Se?(0,Z.jsxs)(r.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Z.jsx)(p.A,{variant:"contained",color:"primary",onClick:()=>{if(ke)try{V.pz(ke)}catch(e){console.error("\u4e0b\u8f7d\u6a21\u677f\u5931\u8d25:",e)}},disabled:!ke,children:"\u4e0b\u8f7d\u6a21\u677f"}),(0,Z.jsx)("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var t;if(!ke)return;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===s.type||"application/vnd.ms-excel"===s.type)&&De(s)},style:{display:"none"},id:"score-file-upload"}),(0,Z.jsx)("label",{htmlFor:"score-file-upload",children:(0,Z.jsx)(p.A,{variant:"outlined",component:"span",disabled:!ke,children:"\u9009\u62e9\u6587\u4ef6"})}),Re&&(0,Z.jsxs)(A.A,{variant:"body2",color:"textSecondary",children:["\u5df2\u9009\u62e9: ",Re.name]})]}):(0,Z.jsx)(r.A,{sx:{mt:2},children:(0,Z.jsxs)(i.A,{spacing:2,children:[(0,Z.jsx)(r.A,{children:(0,Z.jsx)(z.A,{options:Be,getOptionLabel:e=>{var t;return"".concat(e.name," (").concat(e.studentNumber,") - ").concat((null===(t=e.classInfo)||void 0===t?void 0:t.className)||"\u672a\u5206\u914d\u73ed\u7ea7")},renderInput:e=>(0,Z.jsx)(D.A,(0,a.A)((0,a.A)({},e),{},{label:"\u641c\u7d22\u5b66\u751f",variant:"outlined",fullWidth:!0})),value:Fe,onChange:(e,t)=>{Ge(t),ze(t?e=>(0,a.A)((0,a.A)({},e),{},{studentNumber:t.studentNumber,studentName:t.name}):e=>(0,a.A)((0,a.A)({},e),{},{studentNumber:"",studentName:""}))},isOptionEqualToValue:(e,t)=>e.id===t.id,noOptionsText:"\u65e0\u5339\u914d\u5b66\u751f",loadingText:"\u52a0\u8f7d\u4e2d..."})}),ke&&(null===re||void 0===re?void 0:re.subjects)&&(0,Z.jsxs)(r.A,{sx:{mt:2},children:[(0,Z.jsx)(A.A,{variant:"subtitle2",gutterBottom:!0,children:"\u79d1\u76ee\u6210\u7ee9"}),(0,Z.jsx)(r.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:2},children:re.subjects.map((e=>(0,Z.jsx)(r.A,{children:(0,Z.jsx)(D.A,{fullWidth:!0,label:e.name,type:"number",value:Ee.scores[e.id]||"",onChange:t=>ze((s=>(0,a.A)((0,a.A)({},s),{},{scores:(0,a.A)((0,a.A)({},s.scores),{},{[e.id]:Number(t.target.value)})}))),inputProps:{min:0,max:e.score,step:.5},InputProps:{endAdornment:(0,Z.jsxs)(T.A,{position:"end",children:["\u6ee1\u5206: ",e.score]})}})},e.id)))})]})]})})]})}),(0,Z.jsxs)(E.A,{children:[(0,Z.jsx)(p.A,{onClick:()=>we(!1),children:"\u53d6\u6d88"}),(0,Z.jsx)(p.A,{variant:"contained",color:"primary",onClick:async()=>{if(ke)if(1===Se)if(Re){Ie(!0);try{console.log("\u51c6\u5907\u5bfc\u5165Excel\u6210\u7ee9\uff0c\u8003\u8bd5ID: ".concat(ke,", \u6587\u4ef6\u540d: ").concat(Re.name));const e=await V.wk(ke,Re);if(console.log("\u5bfc\u5165\u6210\u7ee9\u54cd\u5e94:",e),!e.data||200!==e.data.code&&200!==e.status)console.error("\u5bfc\u5165\u6210\u7ee9\u54cd\u5e94\u683c\u5f0f\u9519\u8bef:",e),Ze("\u5bfc\u5165\u5931\u8d25\uff0c\u54cd\u5e94\u683c\u5f0f\u9519\u8bef","error");else{const t=e.data.data;console.log("\u5bfc\u5165\u7ed3\u679c\u8be6\u60c5:",t);let s="\u6210\u7ee9\u5bfc\u5165\u6210\u529f\uff0c\u5171\u5904\u7406 ".concat(t.totalCount," \u6761\u8bb0\u5f55\uff0c\u6210\u529f ").concat(t.successCount," \u6761");t.failCount>0&&(s+="\uff0c\u5931\u8d25 ".concat(t.failCount," \u6761")),t.skipCount>0&&(s+="\uff0c\u8df3\u8fc7 ".concat(t.skipCount," \u6761")),t.errors&&t.errors.length>0&&(console.log("\u5bfc\u5165\u9519\u8bef:",t.errors),s+="\u3002\u8bf7\u67e5\u770b\u63a7\u5236\u53f0\u83b7\u53d6\u8be6\u7ec6\u9519\u8bef\u4fe1\u606f\u3002"),Ze(s,t.successCount>0?"success":"warning"),t.successCount>0&&(we(!1),ke===se&&qe())}}catch(e){console.error("\u6210\u7ee9\u5bfc\u5165\u5931\u8d25:",e);let t="\u6210\u7ee9\u5bfc\u5165\u5931\u8d25";e.response?(console.error("\u9519\u8bef\u54cd\u5e94:",e.response),e.response.data&&e.response.data.message?t=e.response.data.message:e.response.statusText&&(t="".concat(t,": ").concat(e.response.statusText))):e.message&&(t="".concat(t,": ").concat(e.message)),Ze(t,"error")}finally{Ie(!1)}}else Ze("\u8bf7\u9009\u62e9Excel\u6587\u4ef6","warning");else{if(!Ee.studentNumber||!Ee.studentName)return void Ze("\u8bf7\u9009\u62e9\u5b66\u751f","warning");const t={};Object.keys(Ee.scores).forEach((e=>{const s=Ee.scores[Number(e)];null!==s&&void 0!==s&&(t[e]=s)}));if(!(Object.keys(t).length>0))return void Ze("\u8bf7\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u79d1\u76ee\u7684\u6210\u7ee9","warning");Ie(!0);try{const e={examId:ke,studentNumber:Ee.studentNumber,studentName:Ee.studentName,scores:t};console.log("\u63d0\u4ea4\u624b\u52a8\u5f55\u5165\u6210\u7ee9\u6570\u636e:",e);const s=await V.B3(e);console.log("\u624b\u52a8\u5f55\u5165\u6210\u7ee9\u54cd\u5e94:",s),!s.data||200!==s.data.code&&200!==s.status?(console.error("\u624b\u52a8\u5f55\u5165\u6210\u7ee9\u54cd\u5e94\u683c\u5f0f\u9519\u8bef:",s),Ze("\u5f55\u5165\u5931\u8d25\uff0c\u54cd\u5e94\u683c\u5f0f\u9519\u8bef","error")):(Ze("\u6210\u7ee9\u5f55\u5165\u6210\u529f","success"),we(!1),ke===se&&qe(),Ke(),Ge(null))}catch(e){console.error("\u624b\u52a8\u5f55\u5165\u6210\u7ee9\u5931\u8d25:",e);let t="\u6210\u7ee9\u5f55\u5165\u5931\u8d25";e.response?(console.error("\u9519\u8bef\u54cd\u5e94:",e.response),e.response.data&&e.response.data.message?t=e.response.data.message:e.response.statusText&&(t="".concat(t,": ").concat(e.response.statusText))):e.message&&(t="".concat(t,": ").concat(e.message)),Ze(t,"error")}finally{Ie(!1)}}else Ze("\u8bf7\u9009\u62e9\u8003\u8bd5","warning")},disabled:Ne||!ke,startIcon:Ne?(0,Z.jsx)(g.A,{size:20}):(0,Z.jsx)(G.A,{}),children:"\u786e\u8ba4"})]})]}),(0,Z.jsx)(O.A,{open:Te.open,autoHideDuration:3e3,onClose:Je,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,Z.jsx)(B.A,{onClose:Je,severity:Te.severity,variant:"filled",sx:{width:"100%"},children:Te.message})})]})})}}}]);
//# sourceMappingURL=246.7873b54a.chunk.js.map