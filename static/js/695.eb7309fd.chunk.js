"use strict";(self.webpackChunkfrontend_react=self.webpackChunkfrontend_react||[]).push([[695],{12695:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var n=a(89379),o=a(65043),s=a(59772),r=a(23811),l=a(22019),c=a(16317),i=a(76399),d=a(91686),u=a(4556),g=a(14647),p=a(6051),h=a(89073),y=a(26553),m=a(58371),v=a(85672),x=a(20691),C=a(89330),A=a(90617),f=a(72411),w=a(75480),S=a(60446),I=a.n(S);const k=a(79722).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});k.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const j="/api/statistics/leaves",b=async e=>{const{classId:t,leaveType:a,period:n,startDate:o,endDate:s,page:r=0,size:l=10}=e;let c="".concat(j,"/students/ranking?period=").concat(n||"MONTH","&page=").concat(r,"&size=").concat(l);return t&&(c+="&classId=".concat(t)),a&&(c+="&leaveType=".concat(a)),o&&s&&(c+="&startDate=".concat(o,"&endDate=").concat(s)),k.get(c)};var T=a(23665),D=a(61713),N=a(70579);const{RangePicker:R}=s.A,{TabPane:z}=r.A,L=()=>{const[e,t]=(0,o.useState)(!1),a=(0,o.useRef)(null),s=(0,o.useRef)(null),S=(0,o.useRef)(null),L=(0,o.useRef)(null),[O,E]=(0,o.useState)([]),[P,M]=(0,o.useState)({classId:null,leaveType:null,period:"MONTH",dateRange:[(0,D.Yq)((0,D.vM)()[0]),(0,D.Yq)((0,D.vM)()[1])]}),[H,Y]=(0,o.useState)({totalCount:0,sickCount:0,personalCount:0,otherCount:0}),[K,W]=(0,o.useState)([]),[B,q]=(0,o.useState)([]),[U,F]=(0,o.useState)({currentPage:1,pageSize:10,total:0}),[J,G]=(0,o.useState)(!1),[_,Q]=(0,o.useState)(null),[V,X]=(0,o.useState)(!1),[Z,$]=(0,o.useState)([]),[ee,te]=(0,o.useState)(!1),[ae,ne]=(0,o.useState)(null),[oe,se]=(0,o.useState)(!1),[re,le]=(0,o.useState)([]),[ce,ie]=(0,o.useState)({currentPage:1,pageSize:10,total:0}),de=(0,o.useCallback)((async()=>{try{const e=await T.uJ();e&&e.data&&E(e.data.map((e=>({label:e.name,value:e.id}))))}catch(e){console.error("\u83b7\u53d6\u73ed\u7ea7\u5217\u8868\u5931\u8d25:",e),l.Ay.error("\u83b7\u53d6\u73ed\u7ea7\u5217\u8868\u5931\u8d25")}}),[]),ue=(0,o.useCallback)((e=>{if(a.current){console.log("\u6e32\u67d3\u8bf7\u5047\u7c7b\u578b\u56fe\u8868\uff0c\u4f7f\u7528\u6570\u636e:",e);try{let t=e.sickCount||0,n=e.personalCount||0,o=e.otherCount||0;console.log("\u4f7f\u7528\u6570\u636e\u6e32\u67d3\u56fe\u8868:",{sickCount:t,personalCount:n,otherCount:o});const s=t>0||n>0||o>0,r=[{value:t,name:"\u75c5\u5047"},{value:n,name:"\u4e8b\u5047"},{value:o,name:"\u5176\u4ed6"}].filter((e=>e.value>0));S.current&&(S.current.dispose(),S.current=null);const l=w.Ts(a.current);S.current=l;const c={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:10,data:["\u75c5\u5047","\u4e8b\u5047","\u5176\u4ed6"].filter((e=>("\u75c5\u5047"!==e||0!==t)&&(("\u4e8b\u5047"!==e||0!==n)&&("\u5176\u4ed6"!==e||0!==o))))},series:[{name:"\u8bf7\u5047\u7c7b\u578b",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:"{b}: {c} ({d}%)"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!0},data:r}]};l.setOption(c),s||l.setOption({title:{text:"\u6682\u65e0\u6570\u636e",left:"center",top:"middle",textStyle:{color:"#999",fontSize:16}}}),l.resize()}catch(t){console.error("\u6e32\u67d3\u8bf7\u5047\u7c7b\u578b\u56fe\u8868\u51fa\u9519:",t)}}else console.log("\u56fe\u8868\u5bb9\u5668\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u6e32\u67d3\u8bf7\u5047\u7c7b\u578b\u56fe\u8868")}),[]),ge=((0,o.useCallback)((()=>{console.log("\u66f4\u65b0\u7edf\u8ba1\u6570\u636e\u663e\u793a");let e={totalCount:H.totalCount,sickCount:H.sickCount,personalCount:H.personalCount,otherCount:H.otherCount};if(P.classId&&K.length>0){const t=K.find((e=>e.classId===P.classId));t&&(console.log("\u4f7f\u7528\u73ed\u7ea7\u6570\u636e:",t),e={totalCount:t.leaveCount||0,sickCount:t.sickLeaveCount||0,personalCount:t.personalLeaveCount||0,otherCount:t.otherLeaveCount||0})}if(P.leaveType)switch(console.log("\u6839\u636e\u8bf7\u5047\u7c7b\u578b\u7b5b\u9009:",P.leaveType),P.leaveType){case"SICK":e={totalCount:e.sickCount,sickCount:e.sickCount,personalCount:0,otherCount:0};break;case"PERSONAL":e={totalCount:e.personalCount,sickCount:0,personalCount:e.personalCount,otherCount:0};break;case"OTHER":e={totalCount:e.otherCount,sickCount:0,personalCount:0,otherCount:e.otherCount}}console.log("\u66f4\u65b0\u540e\u7684\u7edf\u8ba1\u6570\u636e:",e),Y(e),requestAnimationFrame((()=>{a.current&&ue(e)}))}),[P.classId,P.leaveType,K,ue,H]),(0,o.useCallback)(((e,t)=>{console.log("\u521d\u59cb\u5316\u56fe\u8868\uff0c\u7edf\u8ba1\u6570\u636e:",e,"\u8d8b\u52bf\u6570\u636e:",t);const a={totalCount:e.totalCount||0,sickCount:e.sickCount||0,personalCount:e.personalCount||0,otherCount:e.otherCount||0};try{if(s.current&&t){console.log("\u521d\u59cb\u5316\u8bf7\u5047\u8d8b\u52bf\u56fe\uff0c\u6570\u636e:",t),L.current&&(L.current.dispose(),L.current=null);const e=w.Ts(s.current);L.current=e;const a=t.dates||[],n=t.counts||[],o={tooltip:{trigger:"axis"},legend:{data:["\u8bf7\u5047\u6570\u91cf"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:a},yAxis:{type:"value"},series:[{name:"\u8bf7\u5047\u6570\u91cf",type:"line",stack:"\u603b\u91cf",data:n,areaStyle:{}}]};e.setOption(o),a.length&&n.length||e.setOption({title:{text:"\u6682\u65e0\u6570\u636e",left:"center",top:"middle",textStyle:{color:"#999",fontSize:16}}}),e.resize()}}catch(n){console.error("\u521d\u59cb\u5316\u8bf7\u5047\u8d8b\u52bf\u56fe\u8868\u51fa\u9519:",n)}return a}),[])),pe=(0,o.useRef)({statisticsLoaded:!1,studentRankingLoaded:!1}),he=(0,o.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!e&&he.timer&&(console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u53d6\u6d88\u4e4b\u524d\u7684\u9632\u6296\u8bf7\u6c42"),clearTimeout(he.timer));const o=async()=>{console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u5f00\u59cb\u6267\u884c\u8bf7\u6c42"),t(!0);try{const t={classId:P.classId,leaveType:P.leaveType,period:P.period,startDate:P.dateRange[0],endDate:P.dateRange[1]};console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u8bf7\u6c42\u53c2\u6570:",t);const o=await(async e=>{const{classId:t,leaveType:a,period:n,startDate:o,endDate:s}=e;let r="".concat(j,"?period=").concat(n||"MONTH");return t&&(r+="&classId=".concat(t)),a&&(r+="&leaveType=".concat(a)),o&&s&&(r+="&startDate=".concat(o,"&endDate=").concat(s)),k.get(r)})(t),s=o.data;console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u8bf7\u5047\u7edf\u8ba1\u6982\u89c8\u6570\u636e:",s);const r=await(async e=>{const{classId:t,leaveType:a,period:n,startDate:o,endDate:s}=e;let r="".concat(j,"/classes?period=").concat(n||"MONTH");return t&&(r+="&classId=".concat(t)),a&&(r+="&leaveType=".concat(a)),o&&s&&(r+="&startDate=".concat(o,"&endDate=").concat(s)),k.get(r)})(t),l=r.data||[];W(l);const c=await(async e=>{const{classId:t,leaveType:a,period:n,startDate:o,endDate:s}=e;let r="".concat(j,"/trend?period=").concat(n||"MONTH");return t&&(r+="&classId=".concat(t)),a&&(r+="&leaveType=".concat(a)),o&&s&&(r+="&startDate=".concat(o,"&endDate=").concat(s)),k.get(r)})(t),i=ge(s,c.data),d=(0,n.A)({},i);if(P.classId&&l.length>0){const e=l.find((e=>e.classId===P.classId));e&&(console.log("\u4f7f\u7528\u73ed\u7ea7\u6570\u636e:",e),Object.assign(d,{totalCount:e.leaveCount||0,sickCount:e.sickLeaveCount||0,personalCount:e.personalLeaveCount||0,otherCount:e.otherLeaveCount||0}))}if(P.leaveType)switch(console.log("\u6839\u636e\u8bf7\u5047\u7c7b\u578b\u7b5b\u9009:",P.leaveType),P.leaveType){case"SICK":Object.assign(d,{totalCount:d.sickCount,personalCount:0,otherCount:0});break;case"PERSONAL":Object.assign(d,{totalCount:d.personalCount,sickCount:0,otherCount:0});break;case"OTHER":Object.assign(d,{totalCount:d.otherCount,sickCount:0,personalCount:0})}Y(d),setTimeout((()=>{if(a.current)try{ue(d)}catch(e){console.error("\u6e32\u67d3\u8bf7\u5047\u7c7b\u578b\u56fe\u8868\u5931\u8d25:",e)}}),200),pe.current.statisticsLoaded=!0,console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u52a0\u8f7d\u5b8c\u6210\uff0c\u5f00\u59cb\u52a0\u8f7d\u5b66\u751f\u6392\u540d\u6570\u636e"),pe.current.statisticsLoaded&&!pe.current.studentRankingLoaded&&ye(e)}catch(o){console.error("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u83b7\u53d6\u5931\u8d25:",o),l.Ay.error("\u83b7\u53d6\u7edf\u8ba1\u6570\u636e\u5931\u8d25")}finally{t(!1)}};e?(console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u7528\u6237\u89e6\u53d1\uff0c\u7acb\u5373\u6267\u884c"),await o()):(console.log("\u3010\u7edf\u8ba1\u6570\u636e\u3011\u7cfb\u7edf\u89e6\u53d1\uff0c\u6dfb\u52a0\u9632\u6296"),he.timer=setTimeout(o,300))}),[P.classId,P.leaveType,P.period,P.dateRange,ge,ue]);he.timer=null;const ye=(0,o.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!e&&ye.timer&&(console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u53d6\u6d88\u4e4b\u524d\u7684\u9632\u6296\u8bf7\u6c42"),clearTimeout(ye.timer));const t=async()=>{try{console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u5f00\u59cb\u6267\u884c\u8bf7\u6c42\uff0c\u9875\u7801:",U.currentPage,"\u6bcf\u9875\u6761\u6570:",U.pageSize);const e={classId:P.classId,leaveType:P.leaveType,period:P.period,startDate:P.dateRange[0],endDate:P.dateRange[1],page:U.currentPage-1,size:U.pageSize};console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u8bf7\u6c42\u53c2\u6570:",e);const t=await b(e);if(t.data&&t.data.content)console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u83b7\u53d6\u5230\u6570\u636e(\u5206\u9875):",t.data),q(t.data.content),F((e=>(0,n.A)((0,n.A)({},e),{},{total:t.data.totalElements||0})));else if(Array.isArray(t.data)){console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u83b7\u53d6\u5230\u6570\u636e(\u6570\u7ec4):",t.data);const e=t.data;q(e),F((t=>(0,n.A)((0,n.A)({},t),{},{total:e.length})))}else console.warn("\u3010\u5b66\u751f\u6392\u540d\u3011\u6536\u5230\u610f\u5916\u7684\u6570\u636e\u683c\u5f0f:",t.data),q([]),F((e=>(0,n.A)((0,n.A)({},e),{},{total:0})));pe.current.studentRankingLoaded=!0}catch(e){console.error("\u3010\u5b66\u751f\u6392\u540d\u3011\u83b7\u53d6\u6570\u636e\u5931\u8d25:",e),l.Ay.error("\u83b7\u53d6\u5b66\u751f\u6392\u540d\u6570\u636e\u5931\u8d25")}};e?(console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u7528\u6237\u89e6\u53d1\uff0c\u7acb\u5373\u6267\u884c"),await t()):(console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u7cfb\u7edf\u89e6\u53d1\uff0c\u6dfb\u52a0\u9632\u6296"),ye.timer=setTimeout(t,300))}),[P.classId,P.leaveType,P.period,P.dateRange,U.currentPage,U.pageSize]);ye.timer=null;const me=(0,o.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce.currentPage,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ce.pageSize,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e)return;!o&&me.timer&&clearTimeout(me.timer);const s=async()=>{se(!0);try{console.log("\u52a0\u8f7d\u5b66\u751f\u8bf7\u5047\u8bb0\u5f55\uff0c\u5b66\u751fID: ".concat(e,", \u9875\u7801: ").concat(t,", \u6bcf\u9875\u6761\u6570: ").concat(a));const o=t-1,s=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const n="/api/leaves/student/".concat(e,"?page=").concat(t,"&size=").concat(a);return k.get(n)}(e,o,a);if(s.data&&s.data.content){console.log("\u83b7\u53d6\u5230\u5b66\u751f\u8bf7\u5047\u8bb0\u5f55:",s.data);const e=s.data.content.map((e=>{!e.type&&e.leaveType&&(e.type=e.leaveType);const t=e.days||Math.ceil((new Date(e.endDate).getTime()-new Date(e.startDate).getTime())/864e5)+1;return console.log("\u5904\u7406\u8bf7\u5047\u8bb0\u5f55:",(0,n.A)((0,n.A)({},e),{},{days:t,type:e.type||e.leaveType||"UNKNOWN"})),(0,n.A)((0,n.A)({},e),{},{days:t,type:e.type||e.leaveType||"UNKNOWN"})}));console.log("\u5904\u7406\u540e\u7684\u8bf7\u5047\u8bb0\u5f55:",e),le(e),ie((e=>(0,n.A)((0,n.A)({},e),{},{total:s.data.totalElements||0})))}else if(Array.isArray(s.data)){console.log("\u83b7\u53d6\u5230\u5b66\u751f\u8bf7\u5047\u8bb0\u5f55(\u6570\u7ec4):",s.data);const e=s.data,t=e.map((e=>{!e.type&&e.leaveType&&(e.type=e.leaveType);const t=e.days||Math.ceil((new Date(e.endDate).getTime()-new Date(e.startDate).getTime())/864e5)+1;return console.log("\u5904\u7406\u8bf7\u5047\u8bb0\u5f55:",(0,n.A)((0,n.A)({},e),{},{days:t,type:e.type||e.leaveType||"UNKNOWN"})),(0,n.A)((0,n.A)({},e),{},{days:t,type:e.type||e.leaveType||"UNKNOWN"})}));console.log("\u5904\u7406\u540e\u7684\u8bf7\u5047\u8bb0\u5f55:",t),le(t),ie((t=>(0,n.A)((0,n.A)({},t),{},{total:e.length})))}}catch(o){console.error("\u83b7\u53d6\u5b66\u751f\u8bf7\u5047\u8bb0\u5f55\u5931\u8d25:",o),l.Ay.error("\u83b7\u53d6\u5b66\u751f\u8bf7\u5047\u8bb0\u5f55\u5931\u8d25")}finally{se(!1)}};o?await s():me.timer=setTimeout(s,300)}),[]);me.timer=null;const ve=(e,t)=>{console.log("\u5206\u9875\u53d8\u5316: \u9875\u7801=".concat(e,", \u6bcf\u9875\u6761\u6570=").concat(t));const a=t||ce.pageSize;ie((t=>(0,n.A)((0,n.A)({},t),{},{currentPage:e,pageSize:a}))),null!==ae&&void 0!==ae&&ae.studentId&&me(ae.studentId,e,a,!0)},xe=e=>{switch(e){case"SICK":return"\u75c5\u5047";case"PERSONAL":return"\u4e8b\u5047";case"OTHER":return"\u5176\u4ed6";default:return"\u672a\u77e5"}},Ce=e=>{switch(e){case"PENDING":return"\u5f85\u5ba1\u6279";case"APPROVED":return"\u5df2\u6279\u51c6";case"REJECTED":return"\u5df2\u62d2\u7edd";default:return"\u672a\u77e5"}};(0,o.useEffect)((()=>{console.log("\u3010\u7ec4\u4ef6\u521d\u59cb\u5316\u3011\u5f00\u59cb\u83b7\u53d6\u6570\u636e"),de();const e=setTimeout((()=>{console.log("\u3010\u7ec4\u4ef6\u521d\u59cb\u5316\u3011\u5ef6\u8fdf\u52a0\u8f7d\u6570\u636e"),he(!0)}),300);return()=>{clearTimeout(e),ye.timer&&clearTimeout(ye.timer),he.timer&&clearTimeout(he.timer),me.timer&&clearTimeout(me.timer),S.current&&(S.current.dispose(),S.current=null),L.current&&(L.current.dispose(),L.current=null)}}),[de,he]);const Ae=(0,o.useRef)(!0),fe=(0,o.useRef)(!0);(0,o.useEffect)((()=>{if(Ae.current)return console.log("\u3010\u7b5b\u9009\u6761\u4ef6\u3011\u9996\u6b21\u6e32\u67d3\uff0c\u8df3\u8fc7\u8bf7\u6c42"),void(Ae.current=!1);console.log("\u3010\u7b5b\u9009\u6761\u4ef6\u53d8\u5316\u3011\u91cd\u65b0\u83b7\u53d6\u6570\u636e:",P),pe.current={statisticsLoaded:!1,studentRankingLoaded:!1},he()}),[P.classId,P.leaveType,P.period,P.dateRange,he]),(0,o.useEffect)((()=>{if(fe.current)return console.log("\u3010\u5b66\u751f\u6392\u540d\u3011\u9996\u6b21\u6e32\u67d3\uff0c\u8df3\u8fc7\u8bf7\u6c42"),void(fe.current=!1);console.log("\u3010\u5b66\u751f\u6392\u540d\u5206\u9875\u53c2\u6570\u53d8\u5316\u3011\u91cd\u65b0\u52a0\u8f7d\u6392\u540d\u6570\u636e"),ye()}),[U.currentPage,U.pageSize,ye]);const we=[{title:"\u73ed\u7ea7",dataIndex:"className",key:"className",width:150},{title:"\u73ed\u7ea7\u4eba\u6570",dataIndex:"totalStudents",key:"totalStudents",width:100},{title:"\u8bf7\u5047\u4eba\u6570",dataIndex:"leaveStudents",key:"leaveStudents",width:100},{title:"\u8bf7\u5047\u7387",dataIndex:"leaveRate",key:"leaveRate",width:100,render:e=>"".concat(e,"%")},{title:"\u8bf7\u5047\u6b21\u6570",dataIndex:"leaveCount",key:"leaveCount",width:100},{title:"\u8bf7\u5047\u603b\u5929\u6570",dataIndex:"totalDays",key:"totalDays",width:120},{title:"\u4eba\u5747\u8bf7\u5047\u5929\u6570",dataIndex:"avgLeaveDays",key:"avgLeaveDays",width:120},{title:"\u75c5\u5047\u6b21\u6570",dataIndex:"sickLeaveCount",key:"sickLeaveCount",width:100},{title:"\u4e8b\u5047\u6b21\u6570",dataIndex:"personalLeaveCount",key:"personalLeaveCount",width:100},{title:"\u5176\u4ed6\u8bf7\u5047\u6b21\u6570",dataIndex:"otherLeaveCount",key:"otherLeaveCount",width:120},{title:"\u64cd\u4f5c",key:"action",fixed:"right",width:120,render:(e,t)=>(0,N.jsx)(c.Ay,{type:"primary",size:"small",onClick:()=>ke(t),children:"\u67e5\u770b\u8be6\u60c5"})}],Se=[{title:"\u6392\u540d",dataIndex:"rank",key:"rank",width:80,render:(e,t,a)=>(U.currentPage-1)*U.pageSize+a+1},{title:"\u5b66\u751f\u59d3\u540d",dataIndex:"studentName",key:"studentName",width:120},{title:"\u73ed\u7ea7",dataIndex:"className",key:"className",width:150},{title:"\u8bf7\u5047\u6b21\u6570",dataIndex:"leaveCount",key:"leaveCount",width:100},{title:"\u8bf7\u5047\u603b\u5929\u6570",dataIndex:"totalDays",key:"totalDays",width:120},{title:"\u75c5\u5047\u6b21\u6570",dataIndex:"sickLeaveCount",key:"sickLeaveCount",width:100},{title:"\u4e8b\u5047\u6b21\u6570",dataIndex:"personalLeaveCount",key:"personalLeaveCount",width:100},{title:"\u5176\u4ed6\u8bf7\u5047\u6b21\u6570",dataIndex:"otherLeaveCount",key:"otherLeaveCount",width:120},{title:"\u64cd\u4f5c",key:"action",fixed:"right",width:120,render:(e,t)=>(0,N.jsx)(c.Ay,{type:"primary",size:"small",onClick:()=>(e=>{ne(e),te(!0),ie((e=>(0,n.A)((0,n.A)({},e),{},{currentPage:1}))),me(e.studentId,1,ce.pageSize,!0)})(t),children:"\u67e5\u770b\u8be6\u60c5"})}],Ie=[{title:"\u5f00\u59cb\u65e5\u671f",dataIndex:"startDate",key:"startDate",width:120},{title:"\u7ed3\u675f\u65e5\u671f",dataIndex:"endDate",key:"endDate",width:120},{title:"\u5929\u6570",dataIndex:"days",key:"days",width:80},{title:"\u8bf7\u5047\u7c7b\u578b",dataIndex:"type",key:"type",width:100,render:(e,t)=>{console.log("\u6e32\u67d3\u8bf7\u5047\u7c7b\u578b:",e,"\u5b8c\u6574\u8bb0\u5f55:",t);let a="";"SICK"===e?a="volcano":"PERSONAL"===e?a="orange":"OTHER"===e&&(a="geekblue");const n=e||t.leaveType||"UNKNOWN";return(0,N.jsx)(i.A,{color:a,children:xe(n)})}},{title:"\u8bf7\u5047\u539f\u56e0",dataIndex:"reason",key:"reason"},{title:"\u72b6\u6001",dataIndex:"status",key:"status",width:100,render:e=>{let t="";return"PENDING"===e?t="gold":"APPROVED"===e?t="green":"REJECTED"===e&&(t="red"),(0,N.jsx)(i.A,{color:t,children:Ce(e)})}},{title:"\u7533\u8bf7\u65f6\u95f4",dataIndex:"createTime",key:"createTime",width:180,render:e=>e?new Date(e).toLocaleString():""}],ke=async e=>{Q(e),G(!0),X(!0);try{var t,a;const n={classId:e.classId,leaveType:P.leaveType,period:P.period,startDate:null===(t=P.dateRange)||void 0===t?void 0:t[0],endDate:null===(a=P.dateRange)||void 0===a?void 0:a[1],page:0,size:50},o=await b(n);o.data&&o.data.content?$(o.data.content):Array.isArray(o.data)&&$(o.data)}catch(n){console.error("\u83b7\u53d6\u73ed\u7ea7\u5b66\u751f\u8bf7\u5047\u6392\u540d\u5931\u8d25:",n),l.Ay.error("\u83b7\u53d6\u73ed\u7ea7\u5b66\u751f\u8bf7\u5047\u6392\u540d\u5931\u8d25")}finally{X(!1)}};return(0,o.useEffect)((()=>{const e=()=>{console.log("\u7a97\u53e3\u5927\u5c0f\u53d8\u5316\uff0c\u8c03\u6574\u56fe\u8868\u5927\u5c0f");try{S.current&&S.current.resize(),L.current&&L.current.resize()}catch(e){console.error("\u8c03\u6574\u56fe\u8868\u5927\u5c0f\u5931\u8d25:",e)}};return window.addEventListener("resize",e),setTimeout(e,500),()=>{window.removeEventListener("resize",e),S.current&&(S.current.dispose(),S.current=null),L.current&&(L.current.dispose(),L.current=null)}}),[]),(0,o.useEffect)((()=>()=>{console.log("\u3010\u7ec4\u4ef6\u5378\u8f7d\u3011\u6e05\u7406\u6240\u6709\u8d44\u6e90"),pe.current={statisticsLoaded:!1,studentRankingLoaded:!1},he.timer&&(clearTimeout(he.timer),he.timer=null),ye.timer&&(clearTimeout(ye.timer),ye.timer=null),me.timer&&(clearTimeout(me.timer),me.timer=null),S.current&&(S.current.dispose(),S.current=null),L.current&&(L.current.dispose(),L.current=null)}),[]),(0,N.jsx)("div",{className:"leave-statistics-container",style:{padding:"20px"},children:(0,N.jsxs)(d.A,{spinning:e,children:[(0,N.jsxs)(u.A,{justify:"space-between",align:"middle",style:{marginBottom:20},children:[(0,N.jsx)(g.A,{children:(0,N.jsx)("h2",{style:{margin:0,fontWeight:600,color:"#333"},children:"\u5b66\u751f\u8bf7\u5047\u7edf\u8ba1"})}),(0,N.jsx)(g.A,{children:(0,N.jsxs)(p.A,{children:[(0,N.jsx)(c.Ay,{type:"primary",icon:(0,N.jsx)(C.A,{}),onClick:async()=>{const e={classId:P.classId,leaveType:P.leaveType,period:P.period,startDate:P.dateRange[0],endDate:P.dateRange[1]};t(!0);try{const t=await(async e=>{const{classId:t,leaveType:a,period:n,startDate:o,endDate:s}=e;let r="".concat(j,"/export?period=").concat(n||"MONTH");return t&&(r+="&classId=".concat(t)),a&&(r+="&leaveType=".concat(a)),o&&s&&(r+="&startDate=".concat(o,"&endDate=").concat(s)),k.get(r,{responseType:"blob"})})(e),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a;const o=t.headers["content-disposition"];let s="\u8bf7\u5047\u7edf\u8ba1\u6570\u636e.xlsx";if(o){const e=o.match(/filename=(.*)/);e&&e[1]&&(s=e[1].replace(/['"]/g,""))}n.setAttribute("download",s),document.body.appendChild(n),n.click(),document.body.removeChild(n),l.Ay.success("\u7edf\u8ba1\u6570\u636e\u5bfc\u51fa\u6210\u529f")}catch(a){console.error("\u5bfc\u51fa\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",a),l.Ay.error("\u5bfc\u51fa\u7edf\u8ba1\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}finally{t(!1)}},children:"\u5bfc\u51fa\u7edf\u8ba1\u6570\u636e"}),(0,N.jsx)(c.Ay,{icon:(0,N.jsx)(A.A,{}),onClick:()=>{console.log("\u3010\u7528\u6237\u64cd\u4f5c\u3011\u624b\u52a8\u5237\u65b0\u6570\u636e"),he(!0)},children:"\u5237\u65b0\u6570\u636e"})]})})]}),(0,N.jsx)(h.A,{style:{marginBottom:20},children:(0,N.jsxs)(p.A,{wrap:!0,style:{width:"100%"},children:[(0,N.jsx)(y.A,{value:P.classId,onChange:e=>M((t=>(0,n.A)((0,n.A)({},t),{},{classId:e}))),options:O,placeholder:"\u8bf7\u9009\u62e9\u73ed\u7ea7",allowClear:!0,style:{width:150}}),(0,N.jsx)(y.A,{value:P.leaveType,onChange:e=>M((t=>(0,n.A)((0,n.A)({},t),{},{leaveType:e}))),options:[{label:"\u75c5\u5047",value:"SICK"},{label:"\u4e8b\u5047",value:"PERSONAL"},{label:"\u5176\u4ed6",value:"OTHER"}],placeholder:"\u8bf7\u9009\u62e9\u7c7b\u578b",allowClear:!0,style:{width:150}}),(0,N.jsx)(y.A,{value:P.period,onChange:e=>{console.log("\u5468\u671f\u53d8\u5316:",e);let t=P.dateRange;if("WEEK"===e){const e=(0,D.xw)();t=[(0,D.Yq)(e[0]),(0,D.Yq)(e[1])]}else if("MONTH"===e){const e=(0,D.vM)();t=[(0,D.Yq)(e[0]),(0,D.Yq)(e[1])]}M((a=>(0,n.A)((0,n.A)({},a),{},{period:e,dateRange:t})))},options:[{label:"\u672c\u5468",value:"WEEK"},{label:"\u672c\u6708",value:"MONTH"},{label:"\u81ea\u5b9a\u4e49",value:"CUSTOM"}],placeholder:"\u8bf7\u9009\u62e9\u7edf\u8ba1\u5468\u671f",style:{width:150}}),"CUSTOM"===P.period&&(0,N.jsx)(R,{value:[I()(P.dateRange[0]),I()(P.dateRange[1])],onChange:(e,t)=>{console.log("\u81ea\u5b9a\u4e49\u65e5\u671f\u8303\u56f4\u53d8\u5316:",t);const a=t[0]&&t[1]?[t[0],t[1]]:P.dateRange;M((e=>(0,n.A)((0,n.A)({},e),{},{dateRange:a})))},format:"YYYY-MM-DD"}),(0,N.jsx)(c.Ay,{type:"primary",icon:(0,N.jsx)(f.A,{}),onClick:()=>{console.log("\u3010\u7528\u6237\u64cd\u4f5c\u3011\u6267\u884c\u67e5\u8be2\uff0c\u7b5b\u9009\u6761\u4ef6:",P),he(!0)},children:"\u67e5\u8be2"}),(0,N.jsx)(c.Ay,{onClick:()=>{console.log("\u3010\u7528\u6237\u64cd\u4f5c\u3011\u91cd\u7f6e\u7b5b\u9009\u6761\u4ef6");const e=(0,D.vM)();M({classId:null,leaveType:null,period:"MONTH",dateRange:[(0,D.Yq)(e[0]),(0,D.Yq)(e[1])]})},children:"\u91cd\u7f6e"})]})}),(0,N.jsxs)(u.A,{gutter:20,style:{marginBottom:20},children:[(0,N.jsx)(g.A,{xs:24,sm:12,md:6,children:(0,N.jsxs)(h.A,{className:"stat-card",style:{background:"linear-gradient(135deg, #6b73ff 0%, #8f93fb 100%)"},children:[(0,N.jsx)("div",{style:{fontSize:32,fontWeight:"bold",marginBottom:10},children:H.totalCount}),(0,N.jsx)("div",{style:{fontSize:16},children:"\u8bf7\u5047\u603b\u6570"})]})}),(0,N.jsx)(g.A,{xs:24,sm:12,md:6,children:(0,N.jsxs)(h.A,{className:"stat-card",style:{background:"linear-gradient(135deg, #ff7676 0%, #f54ea2 100%)"},children:[(0,N.jsx)("div",{style:{fontSize:32,fontWeight:"bold",marginBottom:10},children:H.sickCount}),(0,N.jsx)("div",{style:{fontSize:16},children:"\u75c5\u5047\u6570\u91cf"})]})}),(0,N.jsx)(g.A,{xs:24,sm:12,md:6,children:(0,N.jsxs)(h.A,{className:"stat-card",style:{background:"linear-gradient(135deg, #42b4ff 0%, #4262ff 100%)"},children:[(0,N.jsx)("div",{style:{fontSize:32,fontWeight:"bold",marginBottom:10},children:H.personalCount}),(0,N.jsx)("div",{style:{fontSize:16},children:"\u4e8b\u5047\u6570\u91cf"})]})}),(0,N.jsx)(g.A,{xs:24,sm:12,md:6,children:(0,N.jsxs)(h.A,{className:"stat-card",style:{background:"linear-gradient(135deg, #ffb199 0%, #ff0844 100%)"},children:[(0,N.jsx)("div",{style:{fontSize:32,fontWeight:"bold",marginBottom:10},children:H.otherCount}),(0,N.jsx)("div",{style:{fontSize:16},children:"\u5176\u4ed6\u8bf7\u5047"})]})})]}),(0,N.jsxs)(u.A,{gutter:20,style:{marginBottom:20},children:[(0,N.jsx)(g.A,{xs:24,md:12,children:(0,N.jsx)(h.A,{title:"\u8bf7\u5047\u7c7b\u578b\u5206\u5e03",styles:{header:{textAlign:"center",fontWeight:500}},children:(0,N.jsx)("div",{ref:a,className:"chart-container"})})}),(0,N.jsx)(g.A,{xs:24,md:12,children:(0,N.jsx)(h.A,{title:"\u8bf7\u5047\u8d8b\u52bf",styles:{header:{textAlign:"center",fontWeight:500}},children:(0,N.jsx)("div",{ref:s,className:"chart-container"})})})]}),(0,N.jsx)(h.A,{title:"\u73ed\u7ea7\u8bf7\u5047\u7edf\u8ba1",style:{marginBottom:20},styles:{header:{fontWeight:500}},children:(0,N.jsx)(m.A,{columns:we,dataSource:K,rowKey:"classId",bordered:!0,scroll:{x:"max-content"},pagination:!1})}),(0,N.jsx)(h.A,{title:"\u5b66\u751f\u8bf7\u5047\u6392\u540d",style:{marginBottom:20},styles:{header:{fontWeight:500}},children:(0,N.jsx)(m.A,{columns:Se,dataSource:B,rowKey:"studentId",bordered:!0,scroll:{x:"max-content"},pagination:{current:U.currentPage,pageSize:U.pageSize,total:U.total,showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:["10","20","50","100"],onChange:(e,t)=>{console.log("\u5b66\u751f\u6392\u540d\u5206\u9875\u53d8\u5316: \u9875\u7801=".concat(e,", \u6bcf\u9875\u6761\u6570=").concat(t)),F({currentPage:e,pageSize:t||U.pageSize,total:U.total})},onShowSizeChange:(e,t)=>{console.log("\u5b66\u751f\u6392\u540d\u6bcf\u9875\u6761\u6570\u53d8\u5316: \u9875\u7801=".concat(e,", \u65b0\u7684\u6bcf\u9875\u6761\u6570=").concat(t)),F({currentPage:1,pageSize:t,total:U.total})},showTotal:e=>"\u5171 ".concat(e," \u6761")}})}),(0,N.jsx)(v.A,{title:"\u73ed\u7ea7\u8bf7\u5047\u8be6\u60c5",open:J,onCancel:()=>{G(!1)},footer:null,width:"80%",destroyOnHidden:!0,style:{top:20},zIndex:1050,centered:!0,className:"leave-statistics-modal",children:_&&(0,N.jsxs)("div",{className:"class-detail",children:[(0,N.jsxs)(x.A,{title:_.className,bordered:!0,column:3,style:{marginBottom:20},children:[(0,N.jsx)(x.A.Item,{label:"\u73ed\u7ea7\u4eba\u6570",children:_.totalStudents}),(0,N.jsx)(x.A.Item,{label:"\u8bf7\u5047\u4eba\u6570",children:_.leaveStudents}),(0,N.jsxs)(x.A.Item,{label:"\u8bf7\u5047\u7387",children:[_.leaveRate,"%"]})]}),(0,N.jsxs)(r.A,{defaultActiveKey:"stats",children:[(0,N.jsx)(z,{tab:"\u8bf7\u5047\u7edf\u8ba1",children:(0,N.jsxs)(x.A,{bordered:!0,column:3,children:[(0,N.jsx)(x.A.Item,{label:"\u8bf7\u5047\u603b\u6b21\u6570",children:_.leaveCount}),(0,N.jsx)(x.A.Item,{label:"\u8bf7\u5047\u603b\u5929\u6570",children:_.totalDays}),(0,N.jsx)(x.A.Item,{label:"\u4eba\u5747\u8bf7\u5047\u5929\u6570",children:_.avgLeaveDays}),(0,N.jsx)(x.A.Item,{label:"\u75c5\u5047\u6b21\u6570",children:_.sickLeaveCount}),(0,N.jsx)(x.A.Item,{label:"\u4e8b\u5047\u6b21\u6570",children:_.personalLeaveCount}),(0,N.jsx)(x.A.Item,{label:"\u5176\u4ed6\u8bf7\u5047\u6b21\u6570",children:_.otherLeaveCount})]})},"stats"),(0,N.jsx)(z,{tab:"\u73ed\u7ea7\u5b66\u751f\u8bf7\u5047\u6392\u540d",children:(0,N.jsx)(d.A,{spinning:V,children:(0,N.jsx)(m.A,{columns:Se.filter((e=>"action"!==e.key)).map((e=>(0,n.A)((0,n.A)({},e),{},{fixed:e.fixed?e.fixed:void 0}))),dataSource:Z,rowKey:"studentId",bordered:!0,pagination:!1})})},"ranking")]})]})}),(0,N.jsx)(v.A,{title:"\u5b66\u751f\u8bf7\u5047\u8be6\u60c5",open:ee,onCancel:()=>{te(!1),ne(null),le([]),ie((e=>(0,n.A)((0,n.A)({},e),{},{currentPage:1,total:0})))},footer:null,width:"80%",destroyOnHidden:!0,style:{top:20},zIndex:1050,centered:!0,className:"leave-statistics-modal",children:ae&&(0,N.jsxs)("div",{className:"student-detail",children:[(0,N.jsxs)(x.A,{title:ae.studentName,bordered:!0,column:3,style:{marginBottom:20},children:[(0,N.jsx)(x.A.Item,{label:"\u73ed\u7ea7",children:ae.className}),(0,N.jsx)(x.A.Item,{label:"\u8bf7\u5047\u603b\u6b21\u6570",children:ae.leaveCount}),(0,N.jsx)(x.A.Item,{label:"\u8bf7\u5047\u603b\u5929\u6570",children:ae.totalDays})]}),(0,N.jsxs)(r.A,{defaultActiveKey:"stats",children:[(0,N.jsx)(z,{tab:"\u8bf7\u5047\u7edf\u8ba1",children:(0,N.jsxs)(x.A,{bordered:!0,column:3,children:[(0,N.jsx)(x.A.Item,{label:"\u75c5\u5047\u6b21\u6570",children:ae.sickLeaveCount}),(0,N.jsx)(x.A.Item,{label:"\u4e8b\u5047\u6b21\u6570",children:ae.personalLeaveCount}),(0,N.jsx)(x.A.Item,{label:"\u5176\u4ed6\u8bf7\u5047\u6b21\u6570",children:ae.otherLeaveCount})]})},"stats"),(0,N.jsx)(z,{tab:"\u8bf7\u5047\u8bb0\u5f55",children:(0,N.jsx)(d.A,{spinning:oe,children:(0,N.jsx)(m.A,{columns:Ie,dataSource:re,rowKey:"id",bordered:!0,pagination:{current:ce.currentPage,pageSize:ce.pageSize,total:ce.total,showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:["10","20","50","100"],onChange:ve,onShowSizeChange:(e,t)=>ve(1,t),showTotal:e=>"\u5171 ".concat(e," \u6761")}})})},"records")]})]})})]})})}},23665:(e,t,a)=>{a.d(t,{Eh:()=>d,Ez:()=>l,I9:()=>i,Zb:()=>s,_p:()=>c,j6:()=>r,uJ:()=>o});const n=a(79722).A.create({baseURL:"http://124.70.74.246:8081",timeout:3e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e)));const o=async()=>{try{console.log("\u5f00\u59cb\u83b7\u53d6\u6240\u6709\u73ed\u7ea7\u6570\u636e");const e=localStorage.getItem("token");console.log("\u5f53\u524d\u8ba4\u8bc1\u4ee4\u724c:",e?"\u6709\u6548":"\u65e0\u6548\u6216\u4e0d\u5b58\u5728"),console.log("\u76f4\u63a5\u8bf7\u6c42\u540e\u7aef http://124.70.74.246:8081/api/classes");const t=await n.get("/api/classes");return console.log("\u83b7\u53d6\u73ed\u7ea7\u6210\u529f:",t),t}catch(e){throw console.error("\u83b7\u53d6\u6240\u6709\u73ed\u7ea7\u5931\u8d25:",e),console.error("\u9519\u8bef\u8be6\u60c5:",e.response?{"\u72b6\u6001\u7801":e.response.status,"\u6570\u636e":e.response.data,"\u8bf7\u6c42\u5934":e.response.headers}:"\u65e0\u54cd\u5e94\u8be6\u60c5"),!e.response||401!==e.response.status&&403!==e.response.status||console.error("\u8ba4\u8bc1\u5931\u8d25\uff0c\u8bf7\u786e\u4fdd\u5df2\u767b\u5f55\u5e76\u6709\u6743\u9650\u8bbf\u95ee\u73ed\u7ea7\u4fe1\u606f"),e}},s=async e=>{try{return await n.get("/api/classes/search?query=".concat(e))}catch(t){throw console.error('\u641c\u7d22\u73ed\u7ea7"'.concat(e,'"\u5931\u8d25:'),t),t}},r=async e=>{try{return await n.post("/api/classes",e)}catch(t){throw console.error("\u521b\u5efa\u73ed\u7ea7\u5931\u8d25:",t),t}},l=async(e,t)=>{try{return await n.put("/api/classes/".concat(e),t)}catch(a){throw console.error("\u66f4\u65b0\u73ed\u7ea7ID=".concat(e,"\u5931\u8d25:"),a),a}},c=async e=>{try{return await n.delete("/api/classes/".concat(e))}catch(t){throw console.error("\u5220\u9664\u73ed\u7ea7ID=".concat(e,"\u5931\u8d25:"),t),t}},i=async(e,t)=>{try{return await n.put("/api/classes/".concat(e,"/assign/").concat(t))}catch(a){throw console.error("\u4e3a\u73ed\u7ea7ID=".concat(e,"\u5206\u914d\u73ed\u4e3b\u4efbID=").concat(t,"\u5931\u8d25:"),a),a}},d=async e=>{try{return console.log("\u5f00\u59cb\u83b7\u53d6\u73ed\u7ea7ID=".concat(e,"\u7684\u5b66\u751f\u4e0b\u62c9\u9009\u9879")),await n.get("/api/students/class/".concat(e,"/select"))}catch(t){throw console.error("\u83b7\u53d6\u73ed\u7ea7ID=".concat(e,"\u7684\u5b66\u751f\u4e0b\u62c9\u9009\u9879\u5931\u8d25:"),t),t}}},61713:(e,t,a)=>{a.d(t,{Yq:()=>o,dX:()=>l,r6:()=>n,vM:()=>r,xw:()=>s});const n=e=>{if(!e)return"";try{if(Array.isArray(e)){const[t,a,n,o=0,s=0]=e;return"".concat(t,"-").concat(String(a).padStart(2,"0"),"-").concat(String(n).padStart(2,"0")," ").concat(String(o).padStart(2,"0"),":").concat(String(s).padStart(2,"0"))}const t=new Date(e);if(isNaN(t.getTime()))return String(e);const a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(o," ").concat(s,":").concat(r)}catch(t){return console.error("\u65e5\u671f\u683c\u5f0f\u5316\u9519\u8bef:",t,e),String(e)}},o=e=>{if(!e)return"";const t=new Date(e),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(o)},s=()=>{const e=new Date,t=e.getDay()||7,a=new Date(e);a.setDate(e.getDate()-t+1),a.setHours(0,0,0,0);const n=new Date(e);return n.setDate(e.getDate()+(7-t)),n.setHours(23,59,59,999),[a,n]},r=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const a=new Date(e.getFullYear(),e.getMonth()+1,0);return a.setHours(23,59,59,999),[t,a]},l=()=>{const e=new Date;let t,a;return e.getMonth()<6?(t=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear(),5,30)):(t=new Date(e.getFullYear(),6,1),a=new Date(e.getFullYear(),11,31)),t.setHours(0,0,0,0),a.setHours(23,59,59,999),[t,a]}}}]);
//# sourceMappingURL=695.eb7309fd.chunk.js.map